var L=Object.defineProperty;var U=(t,e,s)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var h=(t,e,s)=>U(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();let showWatermark=0;const debug=0,debugOverlay=0;function ASSERT(){}function debugRect(){}function debugPoly(){}function debugCircle(){}function debugPoint(){}function debugLine(){}function debugOverlap(){}function debugText(){}function debugClear(){}function debugSaveCanvas(){}function debugSaveText(){}function debugSaveDataURL(){}const PI=Math.PI;function abs(t){return Math.abs(t)}function min(t,e){return Math.min(t,e)}function max(t,e){return Math.max(t,e)}function sign(t){return Math.sign(t)}function mod(t,e=1){return(t%e+e)%e}function clamp(t,e=0,s=1){return t<e?e:t>s?s:t}function percent(t,e,s){return(s-=e)?clamp((t-e)/s):0}function lerp(t,e,s){return e+clamp(t)*(s-e)}function distanceWrap(t,e,s=1){return t=(t-e)%s,2*t%s-t}function lerpWrap(t,e,s,n=1){return s+clamp(t)*distanceWrap(e,s,n)}function distanceAngle(t,e){return distanceWrap(t,e,2*PI)}function lerpAngle(t,e,s){return lerpWrap(t,e,s,2*PI)}function smoothStep(t){return t*t*(3-2*t)}function nearestPowerOfTwo(t){return 2**Math.ceil(Math.log2(t))}function isOverlapping(t,e,s,n=vec2$1()){return 2*abs(t.x-s.x)<e.x+n.x&&2*abs(t.y-s.y)<e.y+n.y}function isIntersecting(t,e,s,n){s=s.subtract(n.scale(.5)),n=s.add(n),e=e.subtract(t),s=t.subtract(s),n=t.subtract(n),t=[-e.x,e.x,-e.y,e.y],e=[s.x,-n.x,s.y,-n.y],s=0,n=1;for(let i=4;i--;)if(t[i]){const a=e[i]/t[i];if(0>t[i]){if(a>n)return!1;s=max(a,s)}else{if(a<s)return!1;n=min(a,n)}}else if(0>e[i])return!1;return!0}function wave(t=1,e=1,s=time){return e/2*(1-Math.cos(s*t*2*PI))}function formatTime(t){return(t/60|0)+":"+(10>t%60?"0":"")+(t%60|0)}function rand(t=1,e=0){return e+Math.random()*(t-e)}function randInt(t,e=0){return Math.floor(rand(t,e))}function randSign(){return 2*randInt(2)-1}function randVector(t=1){return new Vector2().setAngle(rand(2*PI),t)}function randInCircle(t=1,e=0){return 0<t?randVector(t*rand(e/t,1)**.5):new Vector2}function randColor(t=new Color,e=new Color(0,0,0,1),s=!1){return s?t.lerp(e,rand()):new Color(rand(t.r,e.r),rand(t.g,e.g),rand(t.b,e.b),rand(t.a,e.a))}class RandomGenerator{constructor(e){this.seed=e}float(e=1,s=0){return this.seed^=this.seed<<13,this.seed^=this.seed>>>17,this.seed^=this.seed<<5,s+(e-s)*abs(this.seed%1e8)/1e8}int(e,s=0){return Math.floor(this.float(e,s))}sign(){return .5<this.float()?1:-1}}function vec2$1(t=0,e){return typeof t=="number"?new Vector2(t,e??t):new Vector2(t.x,t.y)}class Vector2{constructor(e=0,s=0){this.x=e,this.y=s,this.isValid()}set(e=0,s=0){return this.x=e,this.y=s,this.isValid(),this}copy(){return new Vector2(this.x,this.y)}add(e){return new Vector2(this.x+e.x,this.y+e.y)}subtract(e){return new Vector2(this.x-e.x,this.y-e.y)}multiply(e){return new Vector2(this.x*e.x,this.y*e.y)}divide(e){return new Vector2(this.x/e.x,this.y/e.y)}scale(e){return new Vector2(this.x*e,this.y*e)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(e){return this.distanceSquared(e)**.5}distanceSquared(e){return(this.x-e.x)**2+(this.y-e.y)**2}normalize(e=1){const s=this.length();return s?this.scale(e/s):new Vector2(0,e)}clampLength(e=1){const s=this.length();return s>e?this.scale(e/s):this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(){return Math.atan2(this.x,this.y)}setAngle(e=0,s=1){return this.x=s*Math.sin(e),this.y=s*Math.cos(e),this}rotate(e){const s=Math.cos(e);return e=Math.sin(e),new Vector2(this.x*s-this.y*e,this.x*e+this.y*s)}setDirection(e,s=1){return e=mod(e,4),vec2$1(e%2?e-1?-s:s:0,e%2?0:e?-s:s)}direction(){return abs(this.x)>abs(this.y)?0>this.x?3:1:0>this.y?2:0}invert(){return new Vector2(this.y,-this.x)}floor(){return new Vector2(Math.floor(this.x),Math.floor(this.y))}area(){return abs(this.x*this.y)}lerp(e,s){return this.add(e.subtract(this).scale(clamp(s)))}arrayCheck(e){return 0<=this.x&&0<=this.y&&this.x<e.x&&this.y<e.y}toString(e=3){}isValid(){return typeof this.x=="number"&&!isNaN(this.x)&&typeof this.y=="number"&&!isNaN(this.y)}}function rgb$1(t,e,s,n){return new Color(t,e,s,n)}function hsl(t,e,s,n){return new Color().setHSLA(t,e,s,n)}function isColor(t){return t instanceof Color}class Color{constructor(e=1,s=1,n=1,i=1){this.r=e,this.g=s,this.b=n,this.a=i,this.isValid()}set(e=1,s=1,n=1,i=1){return this.r=e,this.g=s,this.b=n,this.a=i,this.isValid(),this}copy(){return new Color(this.r,this.g,this.b,this.a)}add(e){return new Color(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}subtract(e){return new Color(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}multiply(e){return new Color(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}divide(e){return new Color(this.r/e.r,this.g/e.g,this.b/e.b,this.a/e.a)}scale(e,s=e){return new Color(this.r*e,this.g*e,this.b*e,this.a*s)}clamp(){return new Color(clamp(this.r),clamp(this.g),clamp(this.b),clamp(this.a))}lerp(e,s){return this.add(e.subtract(this).scale(clamp(s)))}setHSLA(e=0,s=0,n=1,i=1){e=mod(e,1),s=clamp(s),n=clamp(n),s=.5>n?n*(1+s):n+s-n*s,n=2*n-s;const a=(o,l,r)=>1>6*(r=mod(r,1))?o+6*(l-o)*r:1>2*r?l:2>3*r?o+(l-o)*(4-6*r):o;return this.r=a(n,s,e+1/3),this.g=a(n,s,e),this.b=a(n,s,e-1/3),this.a=i,this.isValid(),this}HSLA(){const e=clamp(this.r),s=clamp(this.g),n=clamp(this.b),i=clamp(this.a),a=Math.max(e,s,n),o=Math.min(e,s,n),l=(a+o)/2;let r=0,c=0;if(a!=o){let d=a-o;c=.5<l?d/(2-a-o):d/(a+o),e==a?r=(s-n)/d+(s<n?6:0):s==a?r=(n-e)/d+2:n==a&&(r=(e-s)/d+4)}return[r/6,c,l,i]}mutate(e=.05,s=0){return new Color(this.r+rand(e,-e),this.g+rand(e,-e),this.b+rand(e,-e),this.a+rand(s,-s)).clamp()}toString(e=!0){const s=n=>(16>(n=255*clamp(n)|0)?"0":"")+n.toString(16);return"#"+s(this.r)+s(this.g)+s(this.b)+(e?s(this.a):"")}setHex(e){return typeof e=="string"&&e[0]=="#",[4,5,7,9].includes(e.length),6>e.length?(this.r=clamp(parseInt(e[1],16)/15),this.g=clamp(parseInt(e[2],16)/15),this.b=clamp(parseInt(e[3],16)/15),this.a=e.length==5?clamp(parseInt(e[4],16)/15):1):(this.r=clamp(parseInt(e.slice(1,3),16)/255),this.g=clamp(parseInt(e.slice(3,5),16)/255),this.b=clamp(parseInt(e.slice(5,7),16)/255),this.a=e.length==9?clamp(parseInt(e.slice(7,9),16)/255):1),this.isValid(),this}rgbaInt(){const e=255*clamp(this.r)|0,s=255*clamp(this.g)<<8,n=255*clamp(this.b)<<16,i=255*clamp(this.a)<<24;return e+s+n+i}isValid(){return typeof this.r=="number"&&!isNaN(this.r)&&typeof this.g=="number"&&!isNaN(this.g)&&typeof this.b=="number"&&!isNaN(this.b)&&typeof this.a=="number"&&!isNaN(this.a)}}const WHITE=rgb$1(),BLACK=rgb$1(0,0,0),GRAY=rgb$1(.5,.5,.5),RED=rgb$1(1,0,0),ORANGE=rgb$1(1,.5,0),YELLOW=rgb$1(1,1,0),GREEN=rgb$1(0,1,0),CYAN=rgb$1(0,1,1),BLUE=rgb$1(0,0,1),PURPLE=rgb$1(.5,0,1),MAGENTA=rgb$1(1,0,1);class Timer{constructor(e){this.time=e==null?void 0:time+e,this.setTime=e}set(e=0){this.time=time+e,this.setTime=e}unset(){this.time=void 0}isSet(){return this.time!=null}active(){return time<this.time}elapsed(){return time>=this.time}get(){return this.isSet()?time-this.time:0}getPercent(){return this.isSet()?percent(this.time-time,this.setTime,0):0}toString(){}valueOf(){return this.get()}}let cameraPos=vec2$1(),cameraScale=32,canvasMaxSize=vec2$1(1920,1080),canvasFixedSize=vec2$1(),canvasPixelated=!0,tilesPixelated=!0,fontDefault="arial",showSplashScreen=!1,headlessMode=!1,glEnable=!0,glOverlay=!0,tileSizeDefault=vec2$1(16),tileFixBleedScale=0,enablePhysicsSolver=!0,objectDefaultMass=1,objectDefaultDamping=1,objectDefaultAngleDamping=1,objectDefaultElasticity=0,objectDefaultFriction=.8,objectMaxSpeed=1,gravity=0,particleEmitRateScale=1,gamepadsEnable=!0,gamepadDirectionEmulateStick=!0,inputWASDEmulateDirection=!0,touchInputEnable=!0,touchGamepadEnable=!1,touchGamepadAnalog=!0,touchGamepadSize=99,touchGamepadAlpha=.3,vibrateEnable=!0,soundEnable=!0,soundVolume=.3,soundDefaultRange=40,soundDefaultTaper=.7,medalDisplayTime=5,medalDisplaySlideTime=.5,medalDisplaySize=vec2$1(640,80),medalDisplayIconSize=50,medalsPreventUnlock=!1;function setCameraPos(t){cameraPos=t}function setCameraScale(t){cameraScale=t}function setCanvasMaxSize(t){canvasMaxSize=t}function setCanvasFixedSize(t){canvasFixedSize=t}function setCanvasPixelated(t){canvasPixelated=t}function setTilesPixelated(t){tilesPixelated=t}function setFontDefault(t){fontDefault=t}function setShowSplashScreen(t){showSplashScreen=t}function setHeadlessMode(t){headlessMode=t}function setGlEnable(t){glEnable=t}function setGlOverlay(t){glOverlay=t}function setTileSizeDefault(t){tileSizeDefault=t}function setTileFixBleedScale(t){tileFixBleedScale=t}function setEnablePhysicsSolver(t){enablePhysicsSolver=t}function setObjectDefaultMass(t){objectDefaultMass=t}function setObjectDefaultDamping(t){objectDefaultDamping=t}function setObjectDefaultAngleDamping(t){objectDefaultAngleDamping=t}function setObjectDefaultElasticity(t){objectDefaultElasticity=t}function setObjectDefaultFriction(t){objectDefaultFriction=t}function setObjectMaxSpeed(t){objectMaxSpeed=t}function setGravity(t){gravity=t}function setParticleEmitRateScale(t){particleEmitRateScale=t}function setGamepadsEnable(t){gamepadsEnable=t}function setGamepadDirectionEmulateStick(t){gamepadDirectionEmulateStick=t}function setInputWASDEmulateDirection(t){inputWASDEmulateDirection=t}function setTouchInputEnable(t){touchInputEnable=t}function setTouchGamepadEnable(t){touchGamepadEnable=t}function setTouchGamepadAnalog(t){touchGamepadAnalog=t}function setTouchGamepadSize(t){touchGamepadSize=t}function setTouchGamepadAlpha(t){touchGamepadAlpha=t}function setVibrateEnable(t){vibrateEnable=t}function setSoundEnable(t){soundEnable=t}function setSoundVolume(t){soundVolume=t,soundEnable&&!headlessMode&&audioGainNode&&(audioGainNode.gain.value=t)}function setSoundDefaultRange(t){soundDefaultRange=t}function setSoundDefaultTaper(t){soundDefaultTaper=t}function setMedalDisplayTime(t){medalDisplayTime=t}function setMedalDisplaySlideTime(t){medalDisplaySlideTime=t}function setMedalDisplaySize(t){medalDisplaySize=t}function setMedalDisplayIconSize(t){medalDisplayIconSize=t}function setMedalsPreventUnlock(t){medalsPreventUnlock=t}function setShowWatermark(t){showWatermark=t}function setDebugKey(t){}class EngineObject{constructor(e=vec2$1(),s=vec2$1(1),n,i=0,a=new Color,o=0){this.pos=e.copy(),this.size=s,this.drawSize=void 0,this.tileInfo=n,this.angle=i,this.color=a,this.additiveColor=void 0,this.mirror=!1,this.mass=objectDefaultMass,this.damping=objectDefaultDamping,this.angleDamping=objectDefaultAngleDamping,this.elasticity=objectDefaultElasticity,this.friction=objectDefaultFriction,this.gravityScale=1,this.renderOrder=o,this.velocity=vec2$1(),this.angleVelocity=0,this.spawnTime=time,this.children=[],this.clampSpeedLinear=!0,this.parent=void 0,this.localPos=vec2$1(),this.localAngle=0,this.collideRaycast=this.isSolid=this.collideSolidObjects=this.collideTiles=!1,engineObjects.push(this)}updateTransforms(){const e=this.parent;if(e){const s=e.getMirrorSign();this.pos=this.localPos.multiply(vec2$1(s,1)).rotate(-e.angle).add(e.pos),this.angle=s*this.localAngle+e.angle}for(const s of this.children)s.updateTransforms()}update(){if(!this.parent){if(this.clampSpeedLinear)this.velocity.x=clamp(this.velocity.x,-objectMaxSpeed,objectMaxSpeed),this.velocity.y=clamp(this.velocity.y,-objectMaxSpeed,objectMaxSpeed);else{var e=this.velocity.lengthSquared();e>objectMaxSpeed*objectMaxSpeed&&(e=objectMaxSpeed/e**.5,this.velocity.x*=e,this.velocity.y*=e)}if(e=this.pos.copy(),this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.mass&&(this.velocity.y+=gravity*this.gravityScale),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.angle+=this.angleVelocity*=this.angleDamping,0<=this.angleDamping&&1>=this.angleDamping,0<=this.damping&&1>=this.damping,enablePhysicsSolver&&this.mass){var s=0>this.velocity.y;if(this.groundObject){var n=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=n+(this.velocity.x-n)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(var i of engineObjectsCollide){if(!this.isSolid&&!i.isSolid||i.destroyed||i.parent||i==this||!isOverlapping(this.pos,this.size,i.pos,i.size))continue;n=this.collideWithObject(i);var a=i.collideWithObject(this);if(!n||!a)continue;if(isOverlapping(e,this.size,i.pos,i.size)){n=e.subtract(i.pos),a=n.length(),n=.01>a?randVector(.001):n.scale(.001/a),this.velocity=this.velocity.add(n),i.mass&&(i.velocity=i.velocity.subtract(n));continue}a=this.size.add(i.size);var o=2*(e.y-i.pos.y)>a.y+gravity;const r=2*abs(e.y-i.pos.y)<a.y;var l=2*abs(e.x-i.pos.x)<a.x;if(n=max(this.elasticity,i.elasticity),o||l||!r){if(this.pos.y=i.pos.y+(a.y/2+.001)*sign(e.y-i.pos.y),i.groundObject&&s||!i.mass)s&&(this.groundObject=i),this.velocity.y*=-n;else if(i.mass){l=(this.mass*this.velocity.y+i.mass*i.velocity.y)/(this.mass+i.mass);const c=i.velocity.y*(i.mass-this.mass)/(this.mass+i.mass)+2*this.velocity.y*this.mass/(this.mass+i.mass);this.velocity.y=lerp(n,l,this.velocity.y*(this.mass-i.mass)/(this.mass+i.mass)+2*i.velocity.y*i.mass/(this.mass+i.mass)),i.velocity.y=lerp(n,l,c)}}!o&&r&&(this.pos.x=i.pos.x+(a.x/2+.001)*sign(e.x-i.pos.x),i.mass?(a=(this.mass*this.velocity.x+i.mass*i.velocity.x)/(this.mass+i.mass),o=i.velocity.x*(i.mass-this.mass)/(this.mass+i.mass)+2*this.velocity.x*this.mass/(this.mass+i.mass),this.velocity.x=lerp(n,a,this.velocity.x*(this.mass-i.mass)/(this.mass+i.mass)+2*i.velocity.x*i.mass/(this.mass+i.mass)),i.velocity.x=lerp(n,a,o)):this.velocity.x*=-n)}this.collideTiles&&tileCollisionTest(this.pos,this.size,this)&&!tileCollisionTest(e,this.size,this)&&(i=tileCollisionTest(vec2$1(e.x,this.pos.y),this.size,this),n=tileCollisionTest(vec2$1(this.pos.x,e.y),this.size,this),(i||!n)&&(this.velocity.y*=-this.elasticity,(this.groundObject=s)?this.pos.y=(e.y-this.size.y/2|0)+this.size.y/2+1e-4:this.pos.y=e.y),n&&(this.pos.x=e.x,this.velocity.x*=-this.elasticity))}}}render(){drawTile(this.pos,this.drawSize||this.size,this.tileInfo,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const e of this.children)e.destroy(e.parent=0)}}localToWorld(e){return this.pos.add(e.rotate(-this.angle))}worldToLocal(e){return e.subtract(this.pos).rotate(this.angle)}localToWorldVector(e){return e.rotate(this.angle)}worldToLocalVector(e){return e.rotate(-this.angle)}collideWithTile(e,s){return 0<e}collideWithObject(e){return!0}getAliveTime(){return time-this.spawnTime}applyAcceleration(e){this.mass&&(this.velocity=this.velocity.add(e))}applyForce(e){this.applyAcceleration(e.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(e,s=vec2$1(),n=0){!e.parent&&this.children.includes(e),this.children.push(e),e.parent=this,e.localPos=s.copy(),e.localAngle=n}removeChild(e){e.parent==this&&this.children.includes(e),this.children.splice(this.children.indexOf(e),1),e.parent=0}setCollision(e=!0,s=!0,n=!0,i=!0){this.collideSolidObjects=e,this.isSolid=s,this.collideTiles=n,this.collideRaycast=i}toString(){}renderDebugInfo(){}}let mainCanvas,mainContext,overlayCanvas,overlayContext,mainCanvasSize=vec2$1(),textureInfos=[],drawCount;function tile(t=vec2$1(),e=tileSizeDefault,s=0,n=0){if(headlessMode)return new TileInfo;typeof e=="number"&&(e=vec2$1(e));var i=textureInfos[s];const a=e.add(vec2$1(2*n));return typeof t=="number"&&(i=i.size.x/a.x|0,t=0<i?vec2$1(t%i,t/i|0):vec2$1()),t=vec2$1(t.x*a.x+n,t.y*a.y+n),new TileInfo(t,e,s,n)}class TileInfo{constructor(e=vec2$1(),s=tileSizeDefault,n=0,i=0){this.pos=e.copy(),this.size=s.copy(),this.textureIndex=n,this.padding=i}offset(e){return new TileInfo(this.pos.add(e),this.size,this.textureIndex)}frame(e){return this.offset(vec2$1(e*(this.size.x+2*this.padding),0))}getTextureInfo(){return textureInfos[this.textureIndex]}}class TextureInfo{constructor(e){this.image=e,this.size=vec2$1(e.width,e.height),this.glTexture=glEnable&&glCreateTexture(e)}}function screenToWorld(t){return new Vector2((t.x-mainCanvasSize.x/2+.5)/cameraScale+cameraPos.x,(t.y-mainCanvasSize.y/2+.5)/-cameraScale+cameraPos.y)}function worldToScreen(t){return new Vector2((t.x-cameraPos.x)*cameraScale+mainCanvasSize.x/2-.5,(t.y-cameraPos.y)*-cameraScale+mainCanvasSize.y/2-.5)}function getCameraSize(){return mainCanvasSize.scale(1/cameraScale)}function drawTile(t,e=vec2$1(1),s,n=new Color,i=0,a,o=new Color(0,0,0,0),l=glEnable,r,c){const d=s&&s.getTextureInfo();if(l)if(r&&(t=screenToWorld(t),e=e.scale(1/cameraScale)),d){var u=vec2$1(1).divide(d.size);l=s.pos.x*u.x,r=s.pos.y*u.y,c=s.size.x*u.x;const m=s.size.y*u.y;u=u.scale(tileFixBleedScale),glSetTexture(d.glTexture),glDraw(t.x,t.y,a?-e.x:e.x,e.y,i,l+u.x,r+u.y,l-u.x+c,r-u.y+m,n.rgbaInt(),o.rgbaInt())}else glDraw(t.x,t.y,e.x,e.y,i,0,0,0,0,0,n.rgbaInt());else showWatermark&&++drawCount,e=vec2$1(e.x,-e.y),drawCanvas2D(t,e,i,a,m=>{if(d){const g=s.pos.x+tileFixBleedScale,y=s.pos.y+tileFixBleedScale,_=s.size.x-2*tileFixBleedScale,v=s.size.y-2*tileFixBleedScale;m.globalAlpha=n.a,m.drawImage(d.image,g,y,_,v,-.5,-.5,1,1),m.globalAlpha=1}else m.fillStyle=n,m.fillRect(-.5,-.5,1,1)},r,c)}function drawRect(t,e,s,n,i,a,o){drawTile(t,e,void 0,s,n,!1,void 0,i,a,o)}function drawLine(t,e,s=.1,n,i,a,o){e=vec2$1((e.x-t.x)/2,(e.y-t.y)/2),s=vec2$1(s,2*e.length()),drawRect(t.add(e),s,n,e.angle(),i,a,o)}function drawPoly(t,e=new Color,s=0,n=new Color(0,0,0),i,a=mainContext){a.fillStyle=e.toString(),a.beginPath();for(const o of i?t:t.map(worldToScreen))a.lineTo(o.x,o.y);a.closePath(),a.fill(),s&&(a.strokeStyle=n.toString(),a.lineWidth=i?s:s*cameraScale,a.stroke())}function drawEllipse(t,e=1,s=1,n=0,i=new Color,a=0,o=new Color(0,0,0),l,r=mainContext){l||(t=worldToScreen(t),e*=cameraScale,s*=cameraScale,a*=cameraScale),r.fillStyle=i.toString(),r.beginPath(),r.ellipse(t.x,t.y,e,s,n,0,9),r.fill(),a&&(r.strokeStyle=o.toString(),r.lineWidth=a,r.stroke())}function drawCircle(t,e=1,s=new Color,n=0,i=new Color(0,0,0),a,o=mainContext){drawEllipse(t,e,e,0,s,n,i,a,o)}function drawCanvas2D(t,e,s,n,i,a,o=mainContext){a||(t=worldToScreen(t),e=e.scale(cameraScale)),o.save(),o.translate(t.x+.5,t.y+.5),o.rotate(s),o.scale(n?-e.x:e.x,-e.y),i(o),o.restore()}function drawText(t,e,s=1,n,i=0,a,o,l,r,c=mainContext){drawTextScreen(t,worldToScreen(e),s*cameraScale,n,i*cameraScale,a,o,l,r,c)}function drawTextOverlay(t,e,s=1,n,i=0,a,o,l,r){drawText(t,e,s,n,i,a,o,l,r,overlayContext)}function drawTextScreen(t,e,s=1,n=new Color,i=0,a=new Color(0,0,0),o="center",l=fontDefault,r,c=overlayContext){c.fillStyle=n.toString(),c.lineWidth=i,c.strokeStyle=a.toString(),c.textAlign=o,c.font=s+"px "+l,c.textBaseline="middle",c.lineJoin="round",e=e.copy(),(t+"").split(`
`).forEach(d=>{i&&c.strokeText(d,e.x,e.y,r),c.fillText(d,e.x,e.y,r),e.y+=s})}function setBlendMode(t,e=glEnable,s){e?glAdditive=t:(s||(s=mainContext),s.globalCompositeOperation=t?"lighter":"source-over")}function combineCanvases(){glCopyToContext(mainContext,!0),mainContext.drawImage(overlayCanvas,0,0),glClearCanvas(),overlayCanvas.width|=0}let engineFontImage;class FontImage{constructor(e,s=vec2$1(8),n=vec2$1(0,1),i=overlayContext){engineFontImage||((engineFontImage=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=e||engineFontImage,this.tileSize=s,this.paddingSize=n,this.context=i}drawText(e,s,n=1,i){this.drawTextScreen(e,worldToScreen(s).floor(),n*cameraScale|0,i)}drawTextScreen(e,s,n=4,i){const a=this.context;a.save();const o=this.tileSize,l=o.add(this.paddingSize).scale(n),r=this.image.width/this.tileSize.x|0;(e+"").split(`
`).forEach((c,d)=>{const u=i?c.length*o.x*n/2|0:0;for(let y=c.length;y--;){var m=c[y].charCodeAt(0);(32>m||127<m)&&(m=127);var g=m-32;m=g%r,g=g/r|0;const _=s.add(vec2$1(y,d).multiply(l));a.drawImage(this.image,m*o.x,g*o.y,o.x,o.y,_.x-u,_.y,o.x*n,o.y*n)}}),a.restore()}}function isFullscreen(){return!!document.fullscreenElement}function toggleFullscreen(){const t=mainCanvas.parentElement;isFullscreen()?document.exitFullscreen&&document.exitFullscreen():t.requestFullscreen&&t.requestFullscreen()}function setCursor(t="auto"){mainCanvas.parentElement.style.cursor=t}function keyIsDown(t,e=0){return inputData[e]&&!!(inputData[e][t]&1)}function keyWasPressed(t,e=0){return inputData[e]&&!!(inputData[e][t]&2)}function keyWasReleased(t,e=0){return inputData[e]&&!!(inputData[e][t]&4)}function clearInput(){inputData=[[]],touchGamepadButtons=[]}const mouseIsDown=keyIsDown,mouseWasPressed=keyWasPressed,mouseWasReleased=keyWasReleased;let mousePos=vec2$1(),mousePosScreen=vec2$1(),mouseWheel=0,isUsingGamepad=!1,preventDefaultInput=!1;function gamepadIsDown(t,e=0){return keyIsDown(t,e+1)}function gamepadWasPressed(t,e=0){return keyWasPressed(t,e+1)}function gamepadWasReleased(t,e=0){return keyWasReleased(t,e+1)}function gamepadStick(t,e=0){return gamepadStickData[e]&&gamepadStickData[e][t]||vec2$1()}let inputData=[[]];function inputUpdate(){headlessMode||(touchInputEnable&&isTouchDevice||document.hasFocus()||clearInput(),mousePos=screenToWorld(mousePosScreen),gamepadsUpdate())}function inputUpdatePost(){if(!headlessMode){for(const t of inputData)for(const e in t)t[e]&=1;mouseWheel=0}}function inputInit(){function t(e){return inputWASDEmulateDirection?e=="KeyW"?"ArrowUp":e=="KeyS"?"ArrowDown":e=="KeyA"?"ArrowLeft":e=="KeyD"?"ArrowRight":e:e}headlessMode||(onkeydown=e=>{e.repeat||(isUsingGamepad=!1,inputData[0][e.code]=3,inputWASDEmulateDirection&&(inputData[0][t(e.code)]=3))},onkeyup=e=>{inputData[0][e.code]=4,inputWASDEmulateDirection&&(inputData[0][t(e.code)]=4)},onmousedown=e=>{soundEnable&&!headlessMode&&audioContext&&audioContext.state!="running"&&audioContext.resume(),isUsingGamepad=!1,inputData[0][e.button]=3,mousePosScreen=mouseToScreen(e),e.button&&e.preventDefault()},onmouseup=e=>inputData[0][e.button]=inputData[0][e.button]&2|4,onmousemove=e=>mousePosScreen=mouseToScreen(e),onwheel=e=>mouseWheel=e.ctrlKey?0:sign(e.deltaY),oncontextmenu=e=>!1,onblur=e=>clearInput(),isTouchDevice&&touchInputEnable&&touchInputInit())}function mouseToScreen(t){if(!mainCanvas||headlessMode)return vec2$1();const e=mainCanvas.getBoundingClientRect();return vec2$1(mainCanvas.width,mainCanvas.height).multiply(vec2$1(percent(t.x,e.left,e.right),percent(t.y,e.top,e.bottom)))}const gamepadStickData=[];function gamepadsUpdate(){const t=o=>{const l=r=>.3<r?percent(r,.3,.8):-.3>r?-percent(-r,.3,.8):0;return vec2$1(l(o.x),l(-o.y)).clampLength()};if(touchGamepadEnable&&isTouchDevice&&touchGamepadTimer.isSet()){var e=gamepadStickData[0]||(gamepadStickData[0]=[]);e[0]=vec2$1(),touchGamepadAnalog?e[0]=t(touchGamepadStick):.3<touchGamepadStick.lengthSquared()&&(e[0].x=Math.round(touchGamepadStick.x),e[0].y=-Math.round(touchGamepadStick.y),e[0]=e[0].clampLength()),e=inputData[1]||(inputData[1]=[]);for(var s=10;s--;){var n=s==3?2:s==2?3:s,i=gamepadIsDown(n,0);e[n]=touchGamepadButtons[s]?i?1:3:i?4:0}}if(gamepadsEnable&&navigator&&navigator.getGamepads&&document.hasFocus())for(e=navigator.getGamepads(),s=e.length;s--;){i=e[s];const o=inputData[s+1]||(inputData[s+1]=[]);if(n=gamepadStickData[s]||(gamepadStickData[s]=[]),i){for(var a=0;a<i.axes.length-1;a+=2)n[a>>1]=t(vec2$1(i.axes[a],i.axes[a+1]));for(a=i.buttons.length;a--;){const l=i.buttons[a],r=gamepadIsDown(a,s);o[a]=l.pressed?r?1:3:r?4:0,isUsingGamepad||(isUsingGamepad=!s&&l.pressed)}gamepadDirectionEmulateStick&&(i=vec2$1((gamepadIsDown(15,s)&&1)-(gamepadIsDown(14,s)&&1),(gamepadIsDown(12,s)&&1)-(gamepadIsDown(13,s)&&1)),i.lengthSquared()&&(n[0]=i.clampLength())),touchGamepadEnable&&isUsingGamepad&&touchGamepadTimer.unset()}}}function vibrate(t=100){vibrateEnable&&!headlessMode&&navigator&&navigator.vibrate&&navigator.vibrate(t)}function vibrateStop(){vibrate(0)}const isTouchDevice=!headlessMode&&window.ontouchstart!==void 0;let touchGamepadTimer=new Timer,touchGamepadButtons,touchGamepadStick;function touchInputInit(){function t(i){soundEnable&&!headlessMode&&audioContext&&audioContext.state!="running"&&audioContext.resume();const a=i.touches.length;if(a){const o=vec2$1(i.touches[0].clientX,i.touches[0].clientY);mousePosScreen=mouseToScreen(o),n?isUsingGamepad=touchGamepadEnable:inputData[0][0]=3}else n&&(inputData[0][0]=inputData[0][0]&2|4);return n=a,document.hasFocus()&&i.preventDefault(),!0}function e(i){if(touchGamepadStick=vec2$1(),touchGamepadButtons=[],isUsingGamepad=!0,i.touches.length&&(touchGamepadTimer.set(),paused&&!n)){touchGamepadButtons[9]=1,t(i);return}const a=vec2$1(touchGamepadSize,mainCanvasSize.y-touchGamepadSize),o=mainCanvasSize.subtract(vec2$1(touchGamepadSize,touchGamepadSize)),l=mainCanvasSize.scale(.5);for(const c of i.touches){var r=mouseToScreen(vec2$1(c.clientX,c.clientY));r.distance(a)<touchGamepadSize?touchGamepadStick=r.subtract(a).scale(2/touchGamepadSize).clampLength():r.distance(o)<touchGamepadSize?(r=r.subtract(o).direction(),touchGamepadButtons[r]=1):r.distance(l)<touchGamepadSize&&!n&&(touchGamepadButtons[9]=1)}return t(i),!0}let s=t;touchGamepadEnable&&(s=e,touchGamepadButtons=[],touchGamepadStick=vec2$1()),document.addEventListener("touchstart",i=>s(i),{passive:!1}),document.addEventListener("touchmove",i=>s(i),{passive:!1}),document.addEventListener("touchend",i=>s(i),{passive:!1}),onmousedown=onmouseup=()=>0;let n}function touchGamepadRender(){if(touchInputEnable&&isTouchDevice&&!headlessMode&&touchGamepadEnable&&touchGamepadTimer.isSet()){var t=percent(touchGamepadTimer.get(),4,3);if(t&&!paused){var e=overlayContext;if(e.save(),e.globalAlpha=t*touchGamepadAlpha,e.strokeStyle="#fff",e.lineWidth=3,e.fillStyle=0<touchGamepadStick.lengthSquared()?"#fff":"#000",e.beginPath(),t=vec2$1(touchGamepadSize,mainCanvasSize.y-touchGamepadSize),touchGamepadAnalog)e.arc(t.x,t.y,touchGamepadSize/2,0,9),e.fill();else for(var s=10;s--;){var n=s*PI/4;e.arc(t.x,t.y,.6*touchGamepadSize,n+PI/8,n+PI/8),s%2&&e.arc(t.x,t.y,.33*touchGamepadSize,n,n),s==1&&e.fill()}for(e.stroke(),t=vec2$1(mainCanvasSize.x-touchGamepadSize,mainCanvasSize.y-touchGamepadSize),s=4;s--;)n=t.add(vec2$1().setDirection(s,touchGamepadSize/2)),e.fillStyle=touchGamepadButtons[s]?"#fff":"#000",e.beginPath(),e.arc(n.x,n.y,touchGamepadSize/4,0,9),e.fill(),e.stroke();e.restore()}}}let audioContext=new AudioContext,audioGainNode;function audioInit(){soundEnable&&!headlessMode&&(audioGainNode=audioContext.createGain(),audioGainNode.connect(audioContext.destination),audioGainNode.gain.value=soundVolume)}class Sound{constructor(e,s=soundDefaultRange,n=soundDefaultTaper){soundEnable&&!headlessMode&&(this.range=s,this.taper=n,this.randomness=0,e&&(this.randomness=e[1]!=null?e[1]:.05,e[1]=0,this.sampleChannels=[zzfxG(...e)],this.sampleRate=zzfxR))}play(e,s=1,n=1,i=1,a=!1){if(soundEnable&&!headlessMode&&this.sampleChannels){var o;if(e){if(o=this.range){const l=cameraPos.distanceSquared(e);if(l>o*o)return;s*=percent(l**.5,o,o*this.taper)}o=2*worldToScreen(e).x/mainCanvas.width-1}return e=n+n*this.randomness*i*rand(-1,1),this.gainNode=audioContext.createGain(),this.source=playSamples(this.sampleChannels,s,e,o,a,this.sampleRate,this.gainNode)}}setVolume(e=1){this.gainNode&&(this.gainNode.gain.value=e)}stop(){this.source&&this.source.stop(),this.source=void 0}getSource(){return this.source}playNote(e,s,n){return this.play(s,n,2**(e/12),0)}getDuration(){return this.sampleChannels&&this.sampleChannels[0].length/this.sampleRate}isLoading(){return!this.sampleChannels}}class SoundWave extends Sound{constructor(e,s=0,n,i,a){super(void 0,n,i),soundEnable&&!headlessMode&&(this.randomness=s,fetch(e).then(o=>o.arrayBuffer()).then(o=>audioContext.decodeAudioData(o)).then(o=>{this.sampleChannels=[];for(let l=o.numberOfChannels;l--;)this.sampleChannels[l]=Array.from(o.getChannelData(l));this.sampleRate=o.sampleRate}).then(()=>a&&a(this)))}}function playAudioFile(t,e=1,s=!1){if(soundEnable&&!headlessMode)return new SoundWave(t,0,0,0,n=>n.play(void 0,e,1,1,s))}class Music extends Sound{constructor(e){super(void 0),soundEnable&&!headlessMode&&(this.randomness=0,this.sampleChannels=zzfxM(...e),this.sampleRate=zzfxR)}playMusic(e,s=!1){return super.play(void 0,e,1,1,s)}}function speak(t,e="",s=1,n=1,i=1){if(soundEnable&&!headlessMode&&speechSynthesis)return t=new SpeechSynthesisUtterance(t),t.lang=e,t.volume=2*s*soundVolume,t.rate=n,t.pitch=i,speechSynthesis.speak(t),t}function speakStop(){speechSynthesis&&speechSynthesis.cancel()}function getNoteFrequency(t,e=220){return e*2**(t/12)}function playSamples(t,e=1,s=1,n=0,i=!1,a=zzfxR,o){if(soundEnable&&!headlessMode){var l=audioContext.createBuffer(t.length,t[0].length,a),r=audioContext.createBufferSource();return t.forEach((c,d)=>l.getChannelData(d).set(c)),r.buffer=l,r.playbackRate.value=s,r.loop=i,o=o||audioContext.createGain(),o.gain.value=e,o.connect(audioGainNode),t=new StereoPannerNode(audioContext,{pan:clamp(n,-1,1)}),r.connect(t).connect(o),audioContext.state!="running"?audioContext.resume().then(()=>r.start()):r.start(),r}}function zzfx(...t){return playSamples([zzfxG(...t)])}const zzfxR=44100;function zzfxG(t=1,e=.05,s=220,n=0,i=0,a=.1,o=0,l=1,r=0,c=0,d=0,u=0,m=0,g=0,y=0,_=0,v=0,w=1,C=0,D=0,b=0){let S=2*PI;var p=zzfxR;let I=r*=500*S/p/p;e=s*=rand(1+e,1-e)*S/p;let k=[],x=0,E=0,f=0,A=1,F=0,N=0,T=0,R;var M=S*abs(b)*2/p,z=Math.cos(M),B=Math.sin(M)/2/2,P=1+B;M=-2*z/P,B=(1-B)/P;let j=(1+sign(b)*z)/2/P;z=-(sign(b)+z)/P;let G=P=0,O=0,$=0;for(n=n*p+9,C*=p,i*=p,a*=p,v*=p,c*=500*S/p**3,y*=S/p,d*=S/p,u*=p,m=m*p|0,R=n+C+i+a+v|0;f<R;k[f++]=T*t)++N%(100*_|0)||(T=o?1<o?2<o?3<o?Math.sin(x**3):clamp(Math.tan(x),1,-1):1-(2*x/S%2+2)%2:1-4*abs(Math.round(x/S)-x/S):Math.sin(x),T=(m?1-D+D*Math.sin(S*f/m):1)*sign(T)*abs(T)**l*(f<n?f/n:f<n+C?1-(f-n)/C*(1-w):f<n+C+i?w:f<R-v?(R-f-v)/a*w:0),T=v?T/2+(v>f?0:(f<R-v?1:(R-f)/v)*k[f-v|0]/2/t):T,b&&(T=$=j*P+z*(P=G)+j*(G=T)-B*O-M*(O=$))),p=(s+=r+=c)*Math.cos(y*E++),x+=p+p*g*Math.sin(f**5),A&&++A>u&&(s+=d,e+=d,A=0),!m||++F%m||(s=e,r=I,A=A||1);return k}function zzfxM(t,e,s,n=125){let i,a,o,l,r,c,d,u,m,g,y,_,v,w=0,C,D=[],b=[],S=[],p=0,I=0,k=1,x={},E=zzfxR/n*60>>2;for(;k;p++)D=[k=u=_=0],s.forEach((f,A)=>{for(d=e[f][p]||[0,0,0],k|=e[f][p]&&1,C=_+(e[f][0].length-2-(u?0:1))*E,v=A==s.length-1,i=2,o=_;i<d.length+v;u=++i){for(r=d[i],m=i==d.length+v-1&&v||g!=(d[0]||0)||r|0,a=0;a<E&&u;a++>E-99&&m&&1>y?y+=1/99:0)c=(1-y)*D[w++]/2||0,b[o]=(b[o]||0)-c*I+c,S[o]=(S[o++]||0)+c*I+c;r&&(y=r%1,I=d[1]||0,r|=0)&&(D=x[[g=d[w=0]||0,r]]=x[[g,r]]||(l=[...t[g]],l[2]*=2**((r-12)/12),0<r?zzfxG(...l):[]))}_=C});return[b,S]}let tileCollision=[],tileCollisionSize=vec2$1();function initTileCollision(t){for(tileCollisionSize=t,tileCollision=[],t=tileCollision.length=tileCollisionSize.area();t--;)tileCollision[t]=0}function setTileCollisionData(t,e=0){t.arrayCheck(tileCollisionSize)&&(tileCollision[(t.y|0)*tileCollisionSize.x+t.x|0]=e)}function getTileCollisionData(t){return t.arrayCheck(tileCollisionSize)?tileCollision[(t.y|0)*tileCollisionSize.x+t.x|0]:0}function tileCollisionTest(t,e=vec2$1(),s){const n=max(t.x-e.x/2|0,0);var i=max(t.y-e.y/2|0,0);const a=min(t.x+e.x/2,tileCollisionSize.x);for(t=min(t.y+e.y/2,tileCollisionSize.y);i<t;++i)for(e=n;e<a;++e){const o=tileCollision[i*tileCollisionSize.x+e];if(o&&(!s||s.collideWithTile(o,vec2$1(e,i))))return!0}return!1}function tileCollisionRaycast(t,e,s){const n=e.subtract(t),i=n.length();var a=n.normalize();a=vec2$1(abs(1/a.x),abs(1/a.y));let o=t.floor(),l=a.x*(0>n.x?t.x-o.x:o.x-t.x+1),r=a.y*(0>n.y?t.y-o.y:o.y-t.y+1);for(;;){const c=getTileCollisionData(o);if(c&&(!s||s.collideWithTile(c,o)))return o.add(vec2$1(.5));if(l>i&&r>i)break;l>r?(o.y+=sign(n.y),r+=a.y):(o.x+=sign(n.x),l+=a.x)}}class TileLayerData{constructor(e,s=0,n=!1,i=new Color){this.tile=e,this.direction=s,this.mirror=n,this.color=i}clear(){this.tile=this.direction=0,this.mirror=!1,this.color=new Color}}class TileLayer extends EngineObject{constructor(e,s=tileCollisionSize,n=tile(),i=vec2$1(1),a=0){for(super(e,s,n,0,void 0,a),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=i,this.isOverlay=!1,this.data=[],e=this.size.area();e--;)this.data.push(new TileLayerData);headlessMode&&(this.redraw=()=>{},this.render=()=>{},this.redrawStart=()=>{},this.redrawEnd=()=>{},this.drawTileData=()=>{},this.drawCanvas2D=()=>{})}setData(e,s,n=!1){e.arrayCheck(this.size)&&(this.data[(e.y|0)*this.size.x+e.x|0]=s,n&&this.drawTileData(e))}getData(e){return e.arrayCheck(this.size)&&this.data[(e.y|0)*this.size.x+e.x|0]}update(){}render(){mainContext!=this.context,glOverlay||this.isOverlay||glCopyToContext(mainContext);const e=worldToScreen(this.pos.add(vec2$1(0,this.size.y*this.scale.y)));(this.isOverlay?overlayContext:mainContext).drawImage(this.canvas,e.x,e.y,cameraScale*this.size.x*this.scale.x,cameraScale*this.size.y*this.scale.y)}redraw(){this.redrawStart(!0);for(let e=this.size.x;e--;)for(let s=this.size.y;s--;)this.drawTileData(vec2$1(e,s),!1);this.redrawEnd()}redrawStart(e=!1){this.savedRenderSettings=[mainCanvas,mainContext,mainCanvasSize,cameraPos,cameraScale],mainCanvas=this.canvas,mainContext=this.context,mainCanvasSize=this.size.multiply(this.tileInfo.size),cameraPos=this.size.scale(.5),cameraScale=this.tileInfo.size.x,e&&(mainCanvas.width=mainCanvasSize.x,mainCanvas.height=mainCanvasSize.y),this.context.imageSmoothingEnabled=!tilesPixelated,glPreRender()}redrawEnd(){mainContext==this.context,glCopyToContext(mainContext,!0),[mainCanvas,mainContext,mainCanvasSize,cameraPos,cameraScale]=this.savedRenderSettings}drawTileData(e,s=!0){var n=this.tileInfo.size;s&&(s=e.multiply(n),this.context.clearRect(s.x,this.canvas.height-s.y,n.x,-n.y)),s=this.getData(e),s.tile!=null&&(mainContext==this.context,e=e.add(vec2$1(.5)),n=tile(s.tile,n,this.tileInfo.textureIndex),drawTile(e,vec2$1(1),n,s.color,s.direction*PI/2,s.mirror))}drawCanvas2D(e,s,n,i,a){const o=this.context;o.save(),e=e.subtract(this.pos).multiply(this.tileInfo.size),s=s.multiply(this.tileInfo.size),o.translate(e.x,this.canvas.height-e.y),o.rotate(n),o.scale(i?-s.x:s.x,s.y),a(o),o.restore()}drawTile(e,s=vec2$1(1),n,i=new Color,a,o){this.drawCanvas2D(e,s,a,o,l=>{const r=n&&n.getTextureInfo();r?(l.globalAlpha=i.a,l.drawImage(r.image,n.pos.x,n.pos.y,n.size.x,n.size.y,-.5,-.5,1,1),l.globalAlpha=1):(l.fillStyle=i,l.fillRect(-.5,-.5,1,1))})}drawRect(e,s,n,i){this.drawTile(e,s,void 0,n,i)}}class ParticleEmitter extends EngineObject{constructor(e,s,n=0,i=0,a=100,o=PI,l,r=new Color,c=new Color,d=new Color(1,1,1,0),u=new Color(1,1,1,0),m=.5,g=.1,y=1,_=.1,v=.05,w=1,C=1,D=0,b=PI,S=.1,p=.2,I=!1,k=!1,x=!0,E=k?1e9:0,f=!1){super(e,vec2$1(),l,s,void 0,E),this.emitSize=n,this.emitTime=i,this.emitRate=a,this.emitConeAngle=o,this.colorStartA=r,this.colorStartB=c,this.colorEndA=d,this.colorEndB=u,this.randomColorLinear=x,this.particleTime=m,this.sizeStart=g,this.sizeEnd=y,this.speed=_,this.angleSpeed=v,this.damping=w,this.angleDamping=C,this.gravityScale=D,this.particleConeAngle=b,this.fadeRate=S,this.randomness=p,this.collideTiles=I,this.additive=k,this.localSpace=f,this.trailScale=0,this.particleCreateCallback=this.particleDestroyCallback=void 0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime||this.getAliveTime()<=this.emitTime){if(this.emitRate*particleEmitRateScale){const e=1/this.emitRate/particleEmitRateScale;for(this.emitTimeBuffer+=timeDelta;0<this.emitTimeBuffer;this.emitTimeBuffer-=e)this.emitParticle()}}else this.destroy()}emitParticle(){var e=typeof this.emitSize=="number"?randInCircle(this.emitSize/2):vec2$1(rand(-.5,.5),rand(-.5,.5)).multiply(this.emitSize).rotate(this.angle);let s=rand(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(e=this.pos.add(e),s+=this.angle);const n=this.randomness;var i=m=>m+m*rand(n,-n);const a=i(this.particleTime),o=i(this.sizeStart),l=i(this.sizeEnd),r=i(this.speed);i=i(this.angleSpeed)*randSign();var c=rand(this.emitConeAngle,-this.emitConeAngle);const d=randColor(this.colorStartA,this.colorStartB,this.randomColorLinear),u=randColor(this.colorEndA,this.colorEndB,this.randomColorLinear);return c=this.localSpace?c:this.angle+c,e=new Particle(e,this.tileInfo,s,d,u,a,o,l,this.fadeRate,this.additive,this.trailScale,this.localSpace&&this,this.particleDestroyCallback),e.velocity=vec2$1().setAngle(c,r),e.angleVelocity=i,e.fadeRate=this.fadeRate,e.damping=this.damping,e.angleDamping=this.angleDamping,e.elasticity=this.elasticity,e.friction=this.friction,e.gravityScale=this.gravityScale,e.collideTiles=this.collideTiles,e.renderOrder=this.renderOrder,e.mirror=!!randInt(2),this.particleCreateCallback&&this.particleCreateCallback(e),e}render(){}}class Particle extends EngineObject{constructor(e,s,n,i,a,o,l,r,c,d,u,m,g){super(e,vec2$1(),s,n),this.colorStart=i,this.colorEndDelta=a.subtract(i),this.lifeTime=o,this.sizeStart=l,this.sizeEndDelta=r-l,this.fadeRate=c,this.additive=d,this.trailScale=u,this.localSpaceEmitter=m,this.destroyCallback=g,this.clampSpeedLinear=!1}render(){const e=min((time-this.spawnTime)/this.lifeTime,1),s=vec2$1(this.sizeStart+e*this.sizeEndDelta);var n=this.fadeRate/2;n=new Color(this.colorStart.r+e*this.colorEndDelta.r,this.colorStart.g+e*this.colorEndDelta.g,this.colorStart.b+e*this.colorEndDelta.b,(this.colorStart.a+e*this.colorEndDelta.a)*(e<n?e/n:e>1-n?(1-e)/n:1)),this.additive&&setBlendMode(!0);let i=this.pos,a=this.angle;if(this.localSpaceEmitter&&(i=this.localSpaceEmitter.pos.add(i.rotate(-this.localSpaceEmitter.angle)),a+=this.localSpaceEmitter.angle),this.trailScale){var o=this.velocity;this.localSpaceEmitter&&(o=o.rotate(-this.localSpaceEmitter.angle));var l=o.length();l&&(o=o.scale(1/l),l*=this.trailScale,s.y=max(s.x,l),a=o.angle(),drawTile(i.add(o.multiply(vec2$1(0,-l/2))),s,this.tileInfo,n,a,this.mirror))}else drawTile(i,s,this.tileInfo,n,a,this.mirror);this.additive&&setBlendMode(),e==1&&(this.color=n,this.size=s,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}const medals={};let medalsDisplayQueue=[],medalsSaveName,medalsDisplayTimeLast;function medalsInit(t){medalsSaveName=t,medalsForEach(e=>e.unlocked=!!localStorage[e.storageKey()]),engineAddPlugin(void 0,function(){if(medalsDisplayQueue.length){var e=medalsDisplayQueue[0],s=timeReal-medalsDisplayTimeLast;if(medalsDisplayTimeLast)if(s>medalDisplayTime)medalsDisplayTimeLast=0,medalsDisplayQueue.shift();else{const n=medalDisplayTime-medalDisplaySlideTime;e.render(s<medalDisplaySlideTime?1-s/medalDisplaySlideTime:s>n?(s-n)/medalDisplaySlideTime:0)}else medalsDisplayTimeLast=timeReal}})}function medalsForEach(t){Object.values(medals).forEach(e=>t(e))}class Medal{constructor(e,s,n="",i="🏆",a){0<=e&&medals[e],this.id=e,this.name=s,this.description=n,this.icon=i,this.unlocked=!1,a&&((this.image=new Image).src=a),medals[e]=this}unlock(){medalsPreventUnlock||this.unlocked||(localStorage[this.storageKey()]=this.unlocked=!0,medalsDisplayQueue.push(this))}render(e=0){const s=overlayContext;var n=min(medalDisplaySize.x,mainCanvas.width);const i=overlayCanvas.width-n;e*=-medalDisplaySize.y,s.save(),s.beginPath(),s.fillStyle=new Color(.9,.9,.9).toString(),s.strokeStyle=new Color(0,0,0).toString(),s.lineWidth=3,s.rect(i,e,n,medalDisplaySize.y),s.fill(),s.stroke(),s.clip(),this.renderIcon(vec2$1(i+15+medalDisplayIconSize/2,e+medalDisplaySize.y/2)),n=vec2$1(i+medalDisplayIconSize+30,e+28),drawTextScreen(this.name,n,38,new Color(0,0,0),0,void 0,"left"),n.y+=32,drawTextScreen(this.description,n,24,new Color(0,0,0),0,void 0,"left"),s.restore()}renderIcon(e,s=medalDisplayIconSize){this.image?overlayContext.drawImage(this.image,e.x-s/2,e.y-s/2,s,s):drawTextScreen(this.icon,e,.7*s,new Color(0,0,0))}storageKey(){return medalsSaveName+"_"+this.id}}let glCanvas,glContext,glAntialias=!0,glShader,glActiveTexture,glArrayBuffer,glGeometryBuffer,glPositionData,glColorData,glInstanceCount,glAdditive,glBatchAdditive;const gl_MAX_INSTANCES=1e4,gl_INDICES_PER_INSTANCE=11,gl_INSTANCE_BYTE_STRIDE=4*gl_INDICES_PER_INSTANCE,gl_INSTANCE_BUFFER_SIZE=gl_MAX_INSTANCES*gl_INSTANCE_BYTE_STRIDE;function glInit(){if(glEnable&&!headlessMode){glCanvas=document.createElement("canvas"),glContext=glCanvas.getContext("webgl2",{antialias:glAntialias});var t=mainCanvas.parentElement;glOverlay&&t.appendChild(glCanvas),glShader=glCreateProgram(`#version 300 es
precision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}`,`#version 300 es
precision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}`),t=new ArrayBuffer(gl_INSTANCE_BUFFER_SIZE),glPositionData=new Float32Array(t),glColorData=new Uint32Array(t),glArrayBuffer=glContext.createBuffer(),glGeometryBuffer=glContext.createBuffer(),t=new Float32Array([glInstanceCount=0,0,1,0,0,1,1,1]),glContext.bindBuffer(glContext.ARRAY_BUFFER,glGeometryBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,t,glContext.STATIC_DRAW)}}function glPreRender(){if(glEnable&&!headlessMode){glClearCanvas(),glContext.useProgram(glShader),glContext.activeTexture(glContext.TEXTURE0),textureInfos[0]&&glContext.bindTexture(glContext.TEXTURE_2D,glActiveTexture=textureInfos[0].glTexture);var t=glAdditive=glBatchAdditive=0,e=(n,i,a,o)=>{n=glContext.getAttribLocation(glShader,n);const l=a&&gl_INSTANCE_BYTE_STRIDE,r=a&&1,c=a==1;glContext.enableVertexAttribArray(n),glContext.vertexAttribPointer(n,o,i,c,l,t),glContext.vertexAttribDivisor(n,r),t+=o*a};glContext.bindBuffer(glContext.ARRAY_BUFFER,glGeometryBuffer),e("g",glContext.FLOAT,0,2),glContext.bindBuffer(glContext.ARRAY_BUFFER,glArrayBuffer),glContext.bufferData(glContext.ARRAY_BUFFER,gl_INSTANCE_BUFFER_SIZE,glContext.DYNAMIC_DRAW),e("p",glContext.FLOAT,4,4),e("u",glContext.FLOAT,4,4),e("c",glContext.UNSIGNED_BYTE,1,4),e("a",glContext.UNSIGNED_BYTE,1,4),e("r",glContext.FLOAT,4,1),e=vec2$1(2*cameraScale).divide(mainCanvasSize);var s=vec2$1(-1).subtract(cameraPos.multiply(e));glContext.uniformMatrix4fv(glContext.getUniformLocation(glShader,"m"),!1,[e.x,0,0,0,0,e.y,0,0,1,1,1,1,s.x,s.y,0,0])}}function glClearCanvas(){glContext.viewport(0,0,glCanvas.width=mainCanvas.width,glCanvas.height=mainCanvas.height),glContext.clear(glContext.COLOR_BUFFER_BIT)}function glSetTexture(t){headlessMode||t==glActiveTexture||(glFlush(),glContext.bindTexture(glContext.TEXTURE_2D,glActiveTexture=t))}function glCompileShader(t,e){return e=glContext.createShader(e),glContext.shaderSource(e,t),glContext.compileShader(e),e}function glCreateProgram(t,e){const s=glContext.createProgram();return glContext.attachShader(s,glCompileShader(t,glContext.VERTEX_SHADER)),glContext.attachShader(s,glCompileShader(e,glContext.FRAGMENT_SHADER)),glContext.linkProgram(s),s}function glCreateTexture(t){const e=glContext.createTexture();return glContext.bindTexture(glContext.TEXTURE_2D,e),t&&t.width?glContext.texImage2D(glContext.TEXTURE_2D,0,glContext.RGBA,glContext.RGBA,glContext.UNSIGNED_BYTE,t):(t=new Uint8Array([255,255,255,255]),glContext.texImage2D(glContext.TEXTURE_2D,0,glContext.RGBA,1,1,0,glContext.RGBA,glContext.UNSIGNED_BYTE,t)),t=tilesPixelated?glContext.NEAREST:glContext.LINEAR,glContext.texParameteri(glContext.TEXTURE_2D,glContext.TEXTURE_MIN_FILTER,t),glContext.texParameteri(glContext.TEXTURE_2D,glContext.TEXTURE_MAG_FILTER,t),e}function glFlush(){if(glInstanceCount){var t=glBatchAdditive?glContext.ONE:glContext.ONE_MINUS_SRC_ALPHA;glContext.blendFuncSeparate(glContext.SRC_ALPHA,t,glContext.ONE,t),glContext.enable(glContext.BLEND),glContext.bufferSubData(glContext.ARRAY_BUFFER,0,glPositionData),glContext.drawArraysInstanced(glContext.TRIANGLE_STRIP,0,4,glInstanceCount),showWatermark&&(drawCount+=glInstanceCount),glInstanceCount=0,glBatchAdditive=glAdditive}}function glCopyToContext(t,e=!1){glEnable&&(glInstanceCount||e)&&(glFlush(),glOverlay&&!e||t.drawImage(glCanvas,0,0))}function glSetAntialias(t=!0){glAntialias=t}function glDraw(t,e,s,n,i,a,o,l,r,c,d=0){(glInstanceCount>=gl_MAX_INSTANCES||glBatchAdditive!=glAdditive)&&glFlush();let u=glInstanceCount++*gl_INDICES_PER_INSTANCE;glPositionData[u++]=t,glPositionData[u++]=e,glPositionData[u++]=s,glPositionData[u++]=n,glPositionData[u++]=a,glPositionData[u++]=o,glPositionData[u++]=l,glPositionData[u++]=r,glColorData[u++]=c,glColorData[u++]=d,glPositionData[u++]=i}const engineName="LittleJS",engineVersion="1.11.4",frameRate=60,timeDelta=1/frameRate;let engineObjects=[],engineObjectsCollide=[],frame=0,time=0,timeReal=0,paused=!1;function setPaused(t){paused=t}let frameTimeLastMS=0,frameTimeBufferMS=0,averageFPS=0;const pluginUpdateList=[],pluginRenderList=[];function engineAddPlugin(t,e){t&&pluginUpdateList.push(t),e&&pluginRenderList.push(e)}function engineInit(t,e,s,n,i,a=[],o=document.body){function l(d=0){var u=d-frameTimeLastMS;if(frameTimeLastMS=d,showWatermark&&(averageFPS=lerp(.05,averageFPS,1e3/(u||1))),d=debug,timeReal+=u/1e3,frameTimeBufferMS+=paused?0:u,d||(frameTimeBufferMS=min(frameTimeBufferMS,50)),r(),paused){for(const g of engineObjects)g.parent||g.updateTransforms();inputUpdate(),pluginUpdateList.forEach(g=>g()),s(),inputUpdatePost()}else{for(u=0,0>frameTimeBufferMS&&-9<frameTimeBufferMS&&(u=frameTimeBufferMS,frameTimeBufferMS=0);0<=frameTimeBufferMS;frameTimeBufferMS-=1e3/frameRate)time=frame++/frameRate,inputUpdate(),e(),pluginUpdateList.forEach(g=>g()),engineObjectsUpdate(),s(),inputUpdatePost();frameTimeBufferMS+=u}if(!headlessMode){mainCanvasSize=vec2$1(mainCanvas.width,mainCanvas.height),overlayContext.imageSmoothingEnabled=mainContext.imageSmoothingEnabled=!tilesPixelated,glPreRender(),n(),engineObjects.sort((g,y)=>g.renderOrder-y.renderOrder);for(var m of engineObjects)m.destroyed||m.render();i(),pluginRenderList.forEach(g=>g()),touchGamepadRender(),glCopyToContext(mainContext),showWatermark&&(overlayContext.textAlign="right",overlayContext.textBaseline="top",overlayContext.font="1em monospace",overlayContext.fillStyle="#000",m=engineName+" v"+engineVersion+" / "+drawCount+" / "+engineObjects.length+" / "+averageFPS.toFixed(1)+(glEnable?" GL":" 2D"),overlayContext.fillText(m,mainCanvas.width-3,3),overlayContext.fillStyle="#fff",overlayContext.fillText(m,mainCanvas.width-2,2),drawCount=0)}requestAnimationFrame(l)}function r(){if(!headlessMode){if(canvasFixedSize.x){mainCanvas.width=canvasFixedSize.x,mainCanvas.height=canvasFixedSize.y;const d=innerWidth/innerHeight,u=mainCanvas.width/mainCanvas.height;(glCanvas||mainCanvas).style.width=mainCanvas.style.width=overlayCanvas.style.width=d<u?"100%":"",(glCanvas||mainCanvas).style.height=mainCanvas.style.height=overlayCanvas.style.height=d<u?"":"100%"}else mainCanvas.width=min(innerWidth,canvasMaxSize.x),mainCanvas.height=min(innerHeight,canvasMaxSize.y);overlayCanvas.width=mainCanvas.width,overlayCanvas.height=mainCanvas.height,mainCanvasSize=vec2$1(mainCanvas.width,mainCanvas.height)}}function c(){new Promise(d=>d(t())).then(l)}headlessMode?c():(o.style.cssText="margin:0;overflow:hidden;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;"+(canvasPixelated?"image-rendering:pixelated;":"")+"user-select:none;-webkit-user-select:none;"+(touchInputEnable?"touch-action:none;-webkit-touch-callout:none":""),o.appendChild(mainCanvas=document.createElement("canvas")),mainContext=mainCanvas.getContext("2d"),inputInit(),audioInit(),glInit(),o.appendChild(overlayCanvas=document.createElement("canvas")),overlayContext=overlayCanvas.getContext("2d"),mainCanvas.style.cssText=overlayCanvas.style.cssText="position:absolute",glCanvas&&(glCanvas.style.cssText="position:absolute"),r(),o=a.map((d,u)=>new Promise(m=>{const g=new Image;g.crossOrigin="anonymous",g.onerror=g.onload=()=>{textureInfos[u]=new TextureInfo(g),m()},g.src=d})),a.length||o.push(new Promise(d=>{textureInfos[0]=new TextureInfo(new Image),d()})),showSplashScreen&&o.push(new Promise(d=>{function u(){clearInput(),drawEngineSplashScreen(m+=.01),1<m?d():setTimeout(u,16)}let m=0;console.log(`${engineName} Engine v${engineVersion}`),u()})),Promise.all(o).then(c))}function engineObjectsUpdate(){function t(e){if(!e.destroyed){e.update();for(const s of e.children)t(s)}}engineObjectsCollide=engineObjects.filter(e=>e.collideSolidObjects);for(const e of engineObjects)e.parent||(t(e),e.updateTransforms());engineObjects=engineObjects.filter(e=>!e.destroyed)}function engineObjectsDestroy(){for(const t of engineObjects)t.parent||t.destroy();engineObjects=engineObjects.filter(t=>!t.destroyed)}function engineObjectsCollect(t,e,s=engineObjects){const n=[];if(t)if(e instanceof Vector2)for(const i of s)isOverlapping(t,e,i.pos,i.size)&&n.push(i);else{e*=e;for(const i of s)t.distanceSquared(i.pos)<e&&n.push(i)}else for(const i of s)n.push(i);return n}function engineObjectsCallback(t,e,s,n=engineObjects){engineObjectsCollect(t,e,n).forEach(i=>s(i))}function engineObjectsRaycast(t,e,s=engineObjects){const n=[];for(const i of s)i.collideRaycast&&isIntersecting(t,e,i.pos,i.size)&&n.push(i);return n}function drawEngineSplashScreen(t){const e=overlayContext;var s=overlayCanvas.width=innerWidth,n=overlayCanvas.height=innerHeight,i=percent(t,1,.8),a=percent(t,0,.5),o=e.createRadialGradient(s/2,n/2,0,s/2,n/2,.7*Math.hypot(s,n));o.addColorStop(0,hsl(0,0,lerp(a,0,i/2),i).toString()),o.addColorStop(1,hsl(0,0,0,i).toString()),e.save(),e.fillStyle=o,e.fillRect(0,0,s,n),o=(r,c,d,u,m)=>{e.beginPath(),e.rect(r,c,d,m?u*l:u),(e.fillStyle=m)?e.fill():e.stroke()},a=(r,c,d,u=0,m=2*PI,g,y)=>{const _=(u+m)/2;u=l*(m-u)/2,e.beginPath(),y&&e.lineTo(r,c),e.arc(r,c,d,_-u,_+u),(e.fillStyle=g)?e.fill():e.stroke()},i=(r=0,c=0)=>hsl([.98,.3,.57,.14][r%4]-10,.8,[0,.3,.5,.8,.9][c]).toString(),t=wave(1,1,t);const l=percent(t,.1,.5);for(e.translate(s/2,n/2),s=min(6,min(s,n)/99),e.scale(s,s),e.translate(-40,-35),e.lineJoin=e.lineCap="round",e.lineWidth=.1+1.9*l,s=percent(t,.1,1),e.setLineDash([99*s,99]),o(7,16,18,-8,i(2,2)),o(7,8,18,4,i(2,3)),o(25,8,8,8,i(2,1)),o(25,8,-18,8),o(25,8,8,8),o(25,16,7,23,i()),o(11,39,14,-23,i(1,1)),o(11,16,14,18,i(1,2)),o(11,16,14,8,i(1,3)),o(25,16,-14,24),o(15,29,6,-9,i(2,2)),a(15,21,5,0,PI/2,i(2,4),1),o(21,21,-6,9),o(37,14,9,6,i(3,2)),o(37,14,4.5,6,i(3,3)),o(37,14,9,6),o(50,20,10,-8,i(0,1)),o(50,20,6.5,-8,i(0,2)),o(50,20,3.5,-8,i(0,3)),o(50,20,10,-8),a(55,2,11.4,.5,PI-.5,i(3,3)),a(55,2,11.4,.5,PI/2,i(3,2),1),a(55,2,11.4,.5,PI-.5),o(45,7,20,-7,i(0,2)),o(45,-1,20,4,i(0,3)),o(45,-1,20,8),s=5;s--;)a(60-6*s,30,9.9,0,2*PI,i(s+2,3)),a(60-6*s,30,10,-.5,PI+.5,i(s+2,2)),a(60-6*s,30,10.1,.5,PI-.5,i(s+2,1));for(a(36,30,10,PI/2,3*PI/2),a(48,30,10,PI/2,3*PI/2),a(60,30,10),e.beginPath(),e.lineTo(36,20),e.lineTo(60,20),e.stroke(),a(60,30,4,PI,3*PI,i(3,2)),a(60,30,4,PI,2*PI,i(3,3)),a(60,30,4,PI,3*PI),s=6;s--;)e.beginPath(),e.lineTo(53,54),e.lineTo(53,40),e.lineTo(53+(1+2.9*s)*l,40),e.lineTo(53+(4+3.5*s)*l,54),e.fillStyle=i(0,s%2+2),e.fill(),s%2&&e.stroke();for(o(6,40,5,5),o(6,40,5,5,i()),o(15,54,38,-14,i()),o=3;o--;)for(s=2;s--;)a(15*o+15,47,s?7:1,PI,3*PI,i(o,3)),e.stroke(),a(15*o+15,47,s?7:1,0,PI,i(o,2)),e.stroke();for(e.beginPath(),e.lineTo(6,40),e.lineTo(68,40),e.stroke(),e.beginPath(),e.lineTo(77,54),e.lineTo(4,54),e.stroke(),a=engineName,e.font="900 16px arial",e.textAlign="center",e.textBaseline="top",e.lineWidth=.1+3.9*l,o=0,s=0;s<a.length;++s)o+=e.measureText(a[s]).width;for(s=2;s--;)for(let r=0,c=41-o/2;r<a.length;++r)e.fillStyle=i(r,2),n=e.measureText(a[r]).width,e[s?"strokeText":"fillText"](a[r],c+n/2,55.5,17*l),c+=n;e.restore()}const LittleJS=Object.freeze(Object.defineProperty({__proto__:null,ASSERT,BLACK,BLUE,CYAN,Color,EngineObject,FontImage,GRAY,GREEN,MAGENTA,Medal,Music,ORANGE,PI,PURPLE,Particle,ParticleEmitter,RED,RandomGenerator,Sound,SoundWave,TextureInfo,TileInfo,TileLayer,TileLayerData,Timer,Vector2,WHITE,YELLOW,abs,audioContext,get cameraPos(){return cameraPos},get cameraScale(){return cameraScale},get canvasFixedSize(){return canvasFixedSize},get canvasMaxSize(){return canvasMaxSize},get canvasPixelated(){return canvasPixelated},clamp,clearInput,combineCanvases,debug,debugCircle,debugClear,debugLine,debugOverlap,debugOverlay,debugPoint,debugPoly,debugRect,debugSaveCanvas,debugSaveDataURL,debugSaveText,debugText,distanceAngle,distanceWrap,drawCanvas2D,drawCircle,drawEllipse,drawLine,drawPoly,drawRect,drawText,drawTextOverlay,drawTextScreen,drawTile,get enablePhysicsSolver(){return enablePhysicsSolver},engineAddPlugin,get engineFontImage(){return engineFontImage},engineInit,engineName,get engineObjects(){return engineObjects},engineObjectsCallback,engineObjectsDestroy,engineObjectsRaycast,engineObjectsUpdate,engineVersion,get fontDefault(){return fontDefault},formatTime,get frame(){return frame},frameRate,get gamepadDirectionEmulateStick(){return gamepadDirectionEmulateStick},gamepadIsDown,gamepadStick,gamepadWasPressed,gamepadWasReleased,get gamepadsEnable(){return gamepadsEnable},gamepadsUpdate,getCameraSize,getNoteFrequency,getTileCollisionData,get glActiveTexture(){return glActiveTexture},get glAdditive(){return glAdditive},get glAntialias(){return glAntialias},get glArrayBuffer(){return glArrayBuffer},get glBatchAdditive(){return glBatchAdditive},get glCanvas(){return glCanvas},glClearCanvas,get glColorData(){return glColorData},glCompileShader,get glContext(){return glContext},glCopyToContext,glCreateProgram,glCreateTexture,glDraw,get glEnable(){return glEnable},glFlush,get glGeometryBuffer(){return glGeometryBuffer},get glInstanceCount(){return glInstanceCount},get glOverlay(){return glOverlay},get glPositionData(){return glPositionData},glSetAntialias,glSetTexture,get glShader(){return glShader},get gravity(){return gravity},get headlessMode(){return headlessMode},hsl,initTileCollision,get inputWASDEmulateDirection(){return inputWASDEmulateDirection},isColor,isFullscreen,isIntersecting,isOverlapping,isTouchDevice,get isUsingGamepad(){return isUsingGamepad},keyIsDown,keyWasPressed,keyWasReleased,lerp,lerpAngle,lerpWrap,get mainCanvas(){return mainCanvas},get mainCanvasSize(){return mainCanvasSize},get mainContext(){return mainContext},max,get medalDisplayIconSize(){return medalDisplayIconSize},get medalDisplaySize(){return medalDisplaySize},get medalDisplaySlideTime(){return medalDisplaySlideTime},get medalDisplayTime(){return medalDisplayTime},medals,medalsInit,get medalsPreventUnlock(){return medalsPreventUnlock},min,mod,mouseIsDown,get mousePos(){return mousePos},get mousePosScreen(){return mousePosScreen},mouseToScreen,mouseWasPressed,mouseWasReleased,get mouseWheel(){return mouseWheel},nearestPowerOfTwo,get objectDefaultAngleDamping(){return objectDefaultAngleDamping},get objectDefaultDamping(){return objectDefaultDamping},get objectDefaultElasticity(){return objectDefaultElasticity},get objectDefaultFriction(){return objectDefaultFriction},get objectDefaultMass(){return objectDefaultMass},get objectMaxSpeed(){return objectMaxSpeed},get overlayCanvas(){return overlayCanvas},get overlayContext(){return overlayContext},get particleEmitRateScale(){return particleEmitRateScale},get paused(){return paused},percent,playAudioFile,playSamples,preventDefaultInput,rand,randColor,randInCircle,randInt,randSign,randVector,rgb:rgb$1,screenToWorld,setBlendMode,setCameraPos,setCameraScale,setCanvasFixedSize,setCanvasMaxSize,setCanvasPixelated,setCursor,setDebugKey,setEnablePhysicsSolver,setFontDefault,setGamepadDirectionEmulateStick,setGamepadsEnable,setGlEnable,setGlOverlay,setGravity,setHeadlessMode,setInputWASDEmulateDirection,setMedalDisplayIconSize,setMedalDisplaySize,setMedalDisplaySlideTime,setMedalDisplayTime,setMedalsPreventUnlock,setObjectDefaultAngleDamping,setObjectDefaultDamping,setObjectDefaultElasticity,setObjectDefaultFriction,setObjectDefaultMass,setObjectMaxSpeed,setParticleEmitRateScale,setPaused,setShowSplashScreen,setShowWatermark,setSoundDefaultRange,setSoundDefaultTaper,setSoundEnable,setSoundVolume,setTileCollisionData,setTileFixBleedScale,setTileSizeDefault,setTilesPixelated,setTouchGamepadAlpha,setTouchGamepadAnalog,setTouchGamepadEnable,setTouchGamepadSize,setTouchInputEnable,setVibrateEnable,get showSplashScreen(){return showSplashScreen},get showWatermark(){return showWatermark},sign,smoothStep,get soundDefaultRange(){return soundDefaultRange},get soundDefaultTaper(){return soundDefaultTaper},get soundEnable(){return soundEnable},get soundVolume(){return soundVolume},speak,speakStop,textureInfos,tile,get tileCollision(){return tileCollision},tileCollisionRaycast,get tileCollisionSize(){return tileCollisionSize},tileCollisionTest,get tileFixBleedScale(){return tileFixBleedScale},get tileSizeDefault(){return tileSizeDefault},get tilesPixelated(){return tilesPixelated},get time(){return time},timeDelta,get timeReal(){return timeReal},toggleFullscreen,get touchGamepadAlpha(){return touchGamepadAlpha},get touchGamepadAnalog(){return touchGamepadAnalog},get touchGamepadEnable(){return touchGamepadEnable},get touchGamepadSize(){return touchGamepadSize},vec2:vec2$1,vibrate,get vibrateEnable(){return vibrateEnable},vibrateStop,wave,worldToScreen,zzfx},Symbol.toStringTag,{value:"Module"})),body=document.getElementById("body"),welcome=document.getElementById("welcome"),game_over=document.getElementById("game_over"),prestige$1=document.getElementById("prestige");function setMainVisible(t){body&&(body.style.display=t?"block":"none")}function setWelcomeVisible(t){welcome&&(welcome.style.display=t?"block":"none")}function setGameOverVisible(t){game_over&&(game_over.style.display=t?"block":"none")}function setPrestigeVisible(t){prestige$1&&(prestige$1.style.display=t?"block":"none")}function getCSSRuleIndex(t){for(let e=0;e<document.styleSheets[0].cssRules.length;e++){const s=document.styleSheets[0].cssRules[e];if(t===s.selectorText)return e}return-1}function init(){setMainVisible(!1),setWelcomeVisible(!0),setGameOverVisible(!1),setPrestigeVisible(!1)}function getData(){return`{"sheets":[{"name":"tasks","columns":[{"typeStr":"0","name":"id","kind":null,"scope":null},{"typeStr":"1","name":"name","kind":"localizable"},{"typeStr":"5:Job,Construction,Exploration,Reproduction","name":"type"},{"typeStr":"2","name":"autoRemove","kind":null},{"typeStr":"2","name":"autoRestart"},{"typeStr":"2","name":"ModifyInvCap"},{"typeStr":"17","name":"need","kind":null},{"typeStr":"17","name":"result","kind":null},{"typeStr":"1","name":"details","kind":"localizable"},{"typeStr":"4","name":"speed","kind":null}],"lines":[{"id":"task_punch_tree","name":"Punch tree","speed":0.5,"need":{"villagers":1},"details":"A Simple resource","autoRestart":true,"result":{"woods":1},"ModifyInvCap":false,"type":0,"autoRemove":false},{"id":"task_punch_berry","name":"Punch berry tree","autoRestart":true,"ModifyInvCap":false,"need":{"villagers":1},"result":{"berries":1},"details":"Used to feed villagers","speed":0.5,"type":0,"autoRemove":false},{"id":"task_punch_rock","name":"Punch rock","need":{"villagers":1},"speed":0.5,"details":"A Simple resource","autoRestart":true,"result":{"stones":1},"ModifyInvCap":false,"type":0,"autoRemove":false},{"id":"task_create_stick","name":"Make a stick","need":{"villagers":1,"woods":1},"speed":0.5,"details":"A Simple resource","autoRestart":true,"result":{"sticks":1},"ModifyInvCap":false,"type":0,"autoRemove":false},{"id":"task_build_house","name":"House","need":{"villagers":1,"woods":2,"stones":1},"speed":0.3,"details":"A nice place to live","autoRestart":false,"result":{"houses":1},"ModifyInvCap":false,"type":1,"autoRemove":false},{"id":"task_build_shed","name":"Shed","need":{"villagers":1,"woods":1,"stones":1,"sticks":1},"speed":0.3,"details":"Increase your inventory cap by 5","autoRestart":false,"result":{"woods":5,"stones":5,"sticks":5,"houses":2,"villagers":2,"berries":5,"custom":"inventory.sheds += 1"},"ModifyInvCap":true,"type":1,"autoRemove":false},{"id":"task_build_shop","name":"Shop","autoRestart":false,"ModifyInvCap":false,"need":{"villagers":1,"woods":20,"stones":20,"sticks":10},"result":{"custom":"readyToUnlock['shop'] = true"},"details":"A place to sell your resources","speed":0.2,"type":1,"autoRemove":true},{"id":"task_build_research_cencer","name":"Research Center","type":1,"autoRemove":true,"autoRestart":false,"ModifyInvCap":false,"need":{"villagers":1,"woods":50,"stones":50,"sticks":25},"result":{"custom":"readyToUnlock['project'] = true"},"details":"Invest in projects, improve quality of life","speed":0.1},{"id":"task_make_offspring","name":"Make Offspring","type":3,"autoRemove":false,"autoRestart":false,"ModifyInvCap":false,"need":{"villagers":2,"houses":1},"result":{"custom":"addTask(['task_raise_offspring']); startTaskID('task_raise_offspring'); inventory.offsprings++"},"details":"Needs a house to grow in","speed":0.2},{"id":"task_raise_offspring","name":"Raise Offspring","type":3,"autoRemove":true,"autoRestart":false,"ModifyInvCap":false,"need":{"offsprings":1,"houses":1},"result":{"villagers":1},"details":"Grow an offspring to a real villager","speed":0.2},{"id":"task_build_warehouse","name":"Warehouse","type":1,"autoRemove":false,"autoRestart":false,"ModifyInvCap":true,"need":{"villagers":2,"sticks":100,"stones":200,"woods":200},"result":{"berries":100,"houses":100,"offsprings":10,"sticks":100,"stones":100,"villagers":20,"woods":100,"custom":"inventory.warehouses +=1"},"details":"Increase your inventory cap by 100","speed":0.1}],"separators":[],"props":{}},{"name":"resources","columns":[{"typeStr":"0","name":"id","kind":null,"scope":null},{"typeStr":"1","name":"name","kind":"localizable"},{"typeStr":"4","name":"price"}],"lines":[{"id":"woods","name":"Wood","price":1},{"id":"stones","name":"Stone","price":1},{"id":"sticks","name":"Stick","price":2},{"id":"berries","name":"Berry","price":1}],"separators":[],"props":{}},{"name":"projects","columns":[{"typeStr":"0","name":"id","kind":null,"scope":null},{"typeStr":"1","name":"name","kind":"localizable"},{"typeStr":"1","name":"log","kind":"localizable"},{"typeStr":"1","name":"description","kind":"localizable"},{"typeStr":"3","name":"cost","kind":null},{"typeStr":"1","name":"action"}],"lines":[{"id":"proj_hire_villager","name":"Hire a Villager","description":"Do more stuffs","action":"inventory.villagers += 1","cost":100,"log":"Hired another villager"},{"id":"proj_auto_gather_food","name":"Gather Food Automatically","description":"When there is not enough food, interrupt the current task and start gathering food","action":"enabledAutomations['auto_gather_food'] = true","cost":150,"log":"Automated Food gathering enabled"},{"id":"proj_auto_gather_wood","name":"Gather Wood Automatically","log":"Automated Wood gathering enabled","description":"When there is no wood, interrupt the current task and start gathering wood","cost":150,"action":"enabledAutomations['auto_gather_wood'] = true"},{"id":"proj_auto_gather_stone","name":"Gather Stone Automatically","log":"Automated Stone gathering enabled","description":"When there is no stone, interrupt the current task and start gathering wood","cost":150,"action":"enabledAutomations['auto_gather_stone'] = true"},{"id":"proj_auto_build_shed","name":"Build Shed Automatically","description":"When the inventory capacity is reached. Build a shed to increase it's cap","action":"enabledAutomations['auto_build_shed'] = true","cost":200,"log":"Automated Shed building enabled"},{"id":"proj_increase_resource_price_by_25","name":"Increase public demand","log":"Resources price increased by 25%","description":"Increase resources price by 25%","cost":250,"action":"increaseResourceCost(25)"},{"id":"proj_double_job_production","name":"Double Job Results","log":"Job results doubled","description":"Double the result of job tasks","cost":250,"action":"increaseJobResults(100)"},{"id":"proj_start_house_building_program","name":"House construction program","log":"","description":"Encourage villagers to build houses","cost":150,"action":"readyToUnlock['house'] = true"},{"id":"proj_procreation","name":"Procreation","log":"","description":"Encourage villagers to make offsprings","cost":150,"action":"readyToUnlock['procreation'] = true"},{"id":"proj_reduce_project_cost_by_10","name":"Reduce Projects cost by 10%","log":"","description":"","cost":0,"action":"costReduction = .1"},{"id":"proj_double_initial_villagers","name":"Double initial villagers number","log":"","description":"","cost":0,"action":"inventory.villagers = 2"}],"separators":[],"props":{}},{"name":"unlocks","columns":[{"typeStr":"0","name":"id","kind":null,"scope":null},{"typeStr":"1","name":"name","kind":null},{"typeStr":"1","name":"condition"},{"typeStr":"1","name":"action","kind":null}],"lines":[{"id":"unlock_shed","name":"Construction: Shed available","condition":"return isInventoryFull()","action":"addTask(['task_build_shed'])"},{"id":"unlock_warehouse","name":"Construction: Warehouse available","condition":"return inventory.max_woods >= 100","action":"addTask(['task_build_warehouse'])"},{"id":"unlock_house","name":"Construction: House available","condition":"return readyToUnlock['house'] == true","action":"addTask(['task_build_house'])"},{"id":"unlock_research_center","name":"Construction: Research Center available","condition":"return shop.style.display == 'block'","action":"addTask(['task_build_research_cencer'])"},{"id":"unlock_shop","name":"Construction: Shop available","condition":"return inventory.max_woods >= 20","action":"addTask(['task_build_shop']); status_money.style.display = 'block';"},{"id":"unlock_auto_gather_food","name":"","condition":"return inventory.villagers >= 2","action":"addProject([ 'proj_auto_gather_food']);"},{"id":"unlock_auto_gather_wood","name":"","condition":"return inventory.villagers >= 2","action":"addProject([ 'proj_auto_gather_wood']);"},{"id":"unlock_auto_gather_stone","name":"","condition":"return inventory.villagers >= 2","action":"addProject([ 'proj_auto_gather_stone']);"},{"id":"unlock_auto_build_shed","name":"","condition":"return inventory.villagers >= 2","action":"addProject([ 'proj_auto_build_shed']);"},{"id":"unlock_projects","name":"Projects are now available","condition":"return readyToUnlock['project'] == true","action":"addProject(['proj_hire_villager'])"},{"id":"unlock_offspring","name":"Villagers are encouraged to make offspring","condition":"return readyToUnlock['procreation'] == true","action":"addTask(['task_make_offspring'])"},{"id":"unlock_show_shop","name":"Resources can now be sold in the shop","condition":"return readyToUnlock['shop'] == true","action":"shop.style.display = 'block'"},{"id":"unlock_inv_woods","name":"","condition":"return inventory.woods >= 1","action":"lab_wood_count.parentElement.style.visibility= 'visible'"},{"id":"unlock_inv_berries","name":"","condition":"return inventory.berries >= 1","action":"lab_berry_count.parentElement.style.visibility= 'visible'"},{"id":"unlock_inv_stones","name":"","condition":"return inventory.stones >= 1","action":"lab_stone_count.parentElement.style.visibility= 'visible'"},{"id":"unlock_inv_houses","name":"","condition":"return inventory.houses>= 1","action":"lab_house_count.parentElement.style.visibility= 'visible'"},{"id":"unlock_inv_offsprings","name":"","condition":"return inventory.offsprings>= 1","action":"lab_offspring_count.parentElement.style.visibility= 'visible'"},{"id":"unlock_inv_sticks","name":"","condition":"return inventory.sticks>= 1","action":"lab_stick_count.parentElement.style.visibility= 'visible'"},{"id":"unlock_increase_resource_cost","name":"","condition":"return totalResourcesSold() >= 200","action":"addProject([ 'proj_increase_resource_cost_by_25']);"},{"id":"unlock_double_job_results","name":"","condition":"return totalResourcesProduiced() >= 200 && readyToUnlock['project'] == true","action":"addProject(['proj_double_job_production','proj_start_house_building_program'])"},{"id":"unlock_procreation","name":"","condition":"return readyToUnlock['house'] == true","action":"addProject(['proj_procreation'])"},{"id":"unlock_prestige","name":"","condition":"return moon >= 100","action":"suggestPrestige()"}],"separators":[],"props":{}},{"name":"quests","columns":[{"typeStr":"0","name":"id","kind":null,"scope":null},{"typeStr":"1","name":"name","kind":"localizable"},{"typeStr":"1","name":"condition","kind":null}],"lines":[{"id":"quest_gather_berry","name":"Gather Berry","condition":"return inventory.berries >= 1"},{"id":"quest_harvest_tree","name":"Harvest a tree","condition":"return inventory.woods >= 1"},{"id":"quest_make_stick","name":"Make a stick","condition":"return inventory.sticks >= 1"},{"id":"quest_gather_stone","name":"Gather Stone","condition":"return inventory.stones >= 1"},{"id":"moon_speed_x2","name":"Set Moon speed x2","condition":"return timeMultiplier == 2"},{"id":"moon_speed_x4","name":"Set Moon speed x4","condition":"return timeMultiplier == 4"},{"id":"pause_moon","name":"Pause the moon","condition":"return isMoonPaused == true"},{"id":"quest_build_shed","name":"Build a Shed","condition":"return inventory.sheds >= 1"},{"id":"quest_build_shop","name":"Build a Shop","condition":"return shop.style.display == 'block'"},{"id":"quest_sell_wood","name":"Sell Wood","condition":"return resourcesSold.woods >= 1"},{"id":"quest_sell_stick","name":"Sell Stick","condition":"return resourcesSold.sticks >= 1"},{"id":"quest_sell_berry","name":"Sell Berry","condition":"return resourcesSold.berries >= 1"},{"id":"quest_sell_stone","name":"Sell Stone","condition":"return resourcesSold.stones >= 1"},{"id":"quest_build_research_cencer","name":"Build a Research Center","condition":"return projects.style.display == 'block'"},{"id":"quest_hire_villager","name":"Hire a Villager","condition":"return inventory.villagers > 1"},{"id":"quest_build_house","name":"Build a House","condition":"return inventory.houses >= 1"},{"id":"quest_make_offspring","name":"Make an offspring","condition":"return inventory.offsprings >= 1"},{"id":"quest_build_warehouse","name":"Build a Warehouse","condition":"return inventory.warehouses >= 1"},{"id":"quest_5_villagers","name":"Have 5 Villagers","condition":"return inventory.villagers >= 5"},{"id":"quest_10_villagers","name":"Have 10 Villagers","condition":"return inventory.villagers >= 10"},{"id":"quest_30_villagers","name":"Have 30 Villagers","condition":"return inventory.villagers >= 30"},{"id":"quest_50_villagers","name":"Have 50 Villagers","condition":"return inventory.villagers >= 50"}],"separators":[],"props":{}},{"name":"automations","columns":[{"typeStr":"0","name":"id","kind":null,"scope":null},{"typeStr":"1","name":"name","kind":"localizable"},{"typeStr":"1","name":"startCondition","kind":null},{"typeStr":"6:tasks","name":"taskID"},{"typeStr":"1","name":"stopCondition","kind":null}],"lines":[{"id":"auto_berry","name":"Gather berries automatically","startCondition":"return enabledAutomations['auto_gather_food'] && food < foodNeeded","stopCondition":"return food >= foodNeeded","taskID":"task_punch_berry"},{"id":"auto_wood","name":"Gather wood automatically","startCondition":"return enabledAutomations['auto_gather_wood'] && inventory.woods <= 0","taskID":"task_punch_tree","stopCondition":"return inventory.woods >= inventory.max_woods/2"},{"id":"auto_stone","name":"Gather stone automatically","startCondition":"return enabledAutomations['auto_gather_stone'] && inventory.stones <= 0","taskID":"task_punch_rock","stopCondition":"return inventory.stones >= inventory.max_stones/2"},{"id":"auto_shed","name":"Build shed automatically","startCondition":"return enabledAutomations['auto_build_shed'] &&  isInventoryFull()","stopCondition":"return  !isInventoryFull()","taskID":"task_build_shed"}],"separators":[],"props":{}},{"name":"tasks@need","props":{"hide":true,"isProps":true},"separators":[],"lines":[],"columns":[{"typeStr":"3","name":"woods","opt":true},{"typeStr":"3","name":"stones","opt":true},{"typeStr":"3","name":"villagers","opt":true},{"typeStr":"3","name":"sticks","opt":true},{"typeStr":"3","name":"houses","opt":true,"kind":null},{"typeStr":"3","name":"offsprings","opt":true,"kind":null}]},{"name":"tasks@result","props":{"hide":true,"isProps":true},"separators":[],"lines":[],"columns":[{"typeStr":"3","name":"woods","opt":true},{"typeStr":"3","name":"stones","opt":true},{"typeStr":"3","name":"sticks","opt":true},{"typeStr":"3","name":"houses","opt":true},{"typeStr":"3","name":"villagers","opt":true},{"typeStr":"3","name":"berries","opt":true},{"typeStr":"1","name":"custom","opt":true},{"typeStr":"3","name":"offsprings","opt":true}]}],"customTypes":[],"compress":true}`}class Task{constructor(e="",s=!1,n,i,a="",o="",l=1,r="",c=0,d=!1){h(this,"_isRunning");h(this,"cssSelectorText");h(this,"isCancelled");h(this,"whyDisabled");h(this,"onCompleted",null);h(this,"progress");h(this,"btn");h(this,"labTitle");this.name=e,this.autoRestart=s,this.need=n,this.result=i,this.describedNeed=a,this.details=o,this.speed=l,this.id=r,this.type=c,this.autoRemove=d,this.cssSelectorText="",this.isCancelled=!1,this.whyDisabled="",this._isRunning=!1,this.progress=null,this.btn=null,this.labTitle=null}set isRunning(e){this._isRunning!=e&&(e?this.showProgress():this.hideProgress()),this._isRunning=e}get isRunning(){return this._isRunning}bindDom(e,s,n){this.progress=e,this.btn=s,this.labTitle=n,this.labTitle&&(this.labTitle.textContent=this.name),this.isRunning=!1}hideProgress(){this.progress&&(this.progress.style.visibility="hidden",this.progress.style.width="0%",this.isCancelled?this.progress.style.alignSelf="flex-start":this.progress.style.alignSelf="flex-end")}showProgress(){this.progress&&(this.progress.style.visibility="visible",this.progress.value=0,this.progress.style.width="100%",this.progress.style.alignSelf="flex-start")}start(){var e;this.isRunning=!0,this.isCancelled=!1,this.cssSelectorText=`#${(e=this.btn)==null?void 0:e.id}::before`,this.setRunningIcon()}stop(e=!1){this.isCancelled=e,this.isRunning=!1,this.resetIcon()}resetProgress(){this.progress&&(this.progress.value=0)}resetIcon(){const e=getCSSRuleIndex(this.cssSelectorText);document.styleSheets[0].cssRules[e]!=null&&document.styleSheets[0].deleteRule(e)}setRunningIcon(){var e;document.styleSheets[0].insertRule(`#${(e=this.btn)==null?void 0:e.id}::before{content:"∎";}`)}reset(){this.resetProgress(),this.isCancelled=!1,this.isRunning=!1}}class Need{constructor(e=0,s=0,n=0,i=0,a=0,o=0){this.villagers=e,this.woods=s,this.stones=n,this.sticks=i,this.offsprings=a,this.money=o}}class Result{constructor(e=0,s=0,n=0,i=0,a=0,o=0,l=0,r=!1,c){h(this,"custom");this.villagers=e,this.woods=s,this.stones=n,this.sticks=i,this.houses=a,this.berries=o,this.offsprings=l,this.modifyInventoryCap=r,this.strCustom=c,this.custom=new Function}}class Quest{constructor(e,s,n){h(this,"_isCompleted");h(this,"eltCheckbox",null);h(this,"eltQuest",null);h(this,"condition");this.id=e,this.name=s,this.strCondition=n,this._isCompleted=!1,this.condition=new Function}set isCompleted(e){this._isCompleted=e,!(!this.eltCheckbox||!this.eltQuest)&&(this._isCompleted?(this.eltCheckbox.checked=!0,this.eltQuest.style.opacity=".6."):(this.eltCheckbox.checked=!1,this.eltQuest.style.opacity="1"))}get isCompleted(){return this._isCompleted}bindDom(e,s){this.eltCheckbox=s,this.eltQuest=e}}class ShopEntry{constructor(e,s,n){h(this,"_price");h(this,"_amount");h(this,"total");h(this,"eltPrice",null);h(this,"eltTotal",null);h(this,"eltName",null);h(this,"eltAmount",null);h(this,"valueChanged",null);this.id=e,this.name=s,this._price=n,this._amount=0,this.total=0}get price(){return this._price}get amount(){return this._amount}set price(e){this._price=e,this.eltPrice&&(this.eltPrice.textContent=e.toString()),this.total=this.amount*e,this.valueChanged!=null&&this.valueChanged()}set amount(e){this._amount=e,this.total=this.amount*this.price,this.eltTotal&&(this.eltTotal.textContent=this.total.toString()),this.valueChanged!=null&&this.valueChanged()}bindDom(e,s,n,i,a=null){this.eltName=e,this.eltPrice=s,this.eltAmount=n,this.eltTotal=i,this.valueChanged=a,this.eltAmount.onchange=()=>{this.eltAmount&&(this.amount=parseInt(this.eltAmount.value))},this.eltAmount.value="0",this.total=0,this.amount=0,this.price=this._price,this.eltName.textContent=this.name}}class Project{constructor(e,s,n,i,a,o){h(this,"isRemoved");h(this,"element",null);h(this,"action");this.id=e,this.name=s,this.description=n,this.log=i,this.cost=a,this.strAction=o,this.isRemoved=!1,this.action=new Function}bindDom(e){this.element=e}}class Unlock{constructor(e,s,n,i,a=!1){h(this,"condition");h(this,"action");this.id=e,this.name=s,this.strCondition=n,this.strAction=i,this.isCompleted=a,this.condition=new Function,this.action=new Function}}class Automation{constructor(e,s,n,i,a){h(this,"isRunning");h(this,"stoppedTaskID");h(this,"runningTask");h(this,"storedAutoRestart");h(this,"isWaiting");h(this,"stopCondition");h(this,"startCondition");this.id=e,this.name=s,this.strStartCondition=n,this.taskID=i,this.strStopCondition=a,this.isRunning=!1,this.stoppedTaskID="",this.runningTask=null,this.storedAutoRestart=!1,this.isWaiting=!1,this.stopCondition=new Function,this.startCondition=new Function}}class Data{constructor(){h(this,"json");h(this,"tasks");h(this,"resources");h(this,"projects");h(this,"unlocks");h(this,"quests");h(this,"automations");this.json=JSON.parse(getData()),this.tasks=this.getSheet("tasks"),this.resources=this.getSheet("resources"),this.projects=this.getSheet("projects"),this.unlocks=this.getSheet("unlocks"),this.quests=this.getSheet("quests"),this.automations=this.getSheet("automations")}getSheet(e){for(const s of this.json.sheets)if(s.name===e)return s}getTaskByID(e){return this.getLineByID(this.tasks,e)}getLineByID(e,s){for(let n of e.lines)if(n.id===s)return n;console.error("method `getLineByID` ",s," not found")}getTaskInstanceByID(e){if(e.length<=0)return;let s=this.getTaskByID(e),n="";for(const i in s.need)n+=s.need[i]+"x "+i+"<br/>";return new Task(s.name,s.autoRestart,new Need(s.need.villagers,s.need.woods,s.need.stones,s.need.sticks,s.need.offsprings,s.need.money),new Result(s.result.villagers,s.result.woods,s.result.stones,s.result.sticks,s.result.houses,s.result.berries,s.result.offsprings,s.ModifyInvCap,s.result.custom),n,s.details,s.speed,e,s.type,s.autoRemove)}getAllTaskInstances(){let e=[];for(const s of this.tasks.lines)e.push(this.getTaskInstanceByID(s.id));return e}getShopEntryInstanceByID(e){let s=this.getLineByID(this.resources,e);return new ShopEntry(s.id,s.name,s.price)}getAllShopEntryInstances(){let e=[];for(const s of this.resources.lines){let n=this.getShopEntryInstanceByID(s.id);const i=document.getElementById(`price_${n.id}`),a=document.getElementById(`name_${n.id}`),o=document.getElementById(`amount_${n.id}`),l=document.getElementById(`total_${n.id}`);i!=null&&a!=null&&o!=null&&l!=null&&(n.bindDom(a,i,o,l),e.push(n))}return e}getProjectInstanceByID(e){const s=this.getLineByID(this.projects,e);return new Project(s.id,s.name,s.description,s.log,s.cost,s.action)}getAllProjectInstances(){const e=this.projects.lines;let s=[];for(const n of e)s.push(this.getProjectInstanceByID(n.id));return s}getAllUnlockInstances(){let e=[];for(const s of this.unlocks.lines)e.push(new Unlock(s.id,s.name,s.condition,s.action));return e}getQuestInstanceByID(e){const s=this.getLineByID(this.quests,e);return new Quest(e,s.name,s.condition)}getAllQuestInstances(){let e=[];for(const s of this.quests.lines){let n=this.getQuestInstanceByID(s.id);e.push(n)}return e}getAllAutomationInstances(){let e=[];for(const s of this.automations.lines){let n=new Automation(s.id,s.name,s.startCondition,s.taskID,s.stopCondition);e.push(n)}return e}}class DomUtils{constructor(){h(this,"taskContainerIDs");this.taskContainerIDs=["job_container","construction_container","exploration_container","reproduction_container"]}addProject(e){if(document.getElementById(e.id)!=null){console.error(`The element id ${e.id} was already created`);return}const s=document.getElementById("project_container");!s||!s.parentElement||(s.parentElement.style.display="block",s.insertAdjacentHTML("beforeend",`
            <li aria-disabled="true" id="${e.id}" class="item project">
                <span class="project_title">
                    <span class="project_name">${e.name}</span>
                    <span class="project_cost">(Money: ${e.cost})</span>
                </span>
                <p class="project_description">${e.description}</p>
            </li>
        `),e.bindDom(document.getElementById(e.id)))}addTask(e){if(e.type>=this.taskContainerIDs.length){console.error(`Task type ${e.type} unknown, task ID: ${e.id}`);return}if(document.getElementById(`progress_${e.id}`)!=null||document.getElementById(`btn_${e.id}`)!=null||document.getElementById(`lab_${e.id}`)!=null){console.error(`The element id ${e.id} was already created`);return}const s=document.getElementById(this.taskContainerIDs[e.type]);!s||!s.parentElement||(s.parentElement.style.display="block",s.insertAdjacentHTML("beforeend",`
            <li class="job" id="${e.id}">
                <div class="title">
                    <span id="lab_${e.id}">${e.name}</span>
                    <button title="Play" id="btn_${e.id}" class="icon-only icon-play"
                        type="button"></button>
                </div>
                <progress id="progress_${e.id}" max="100" min="0" value="0"></progress>
            </li>
        `),e.bindDom(document.querySelector(`#progress_${e.id}`),document.querySelector(`#btn_${e.id}`),document.querySelector(`#lab_${e.id}`)))}addQuest(e){const s=document.getElementById("quest_container");if(!(!s||!s.parentElement)){if(document.getElementById(`${e.id}`)!=null){console.error(`The element id ${e.id} was already created`);return}s.insertAdjacentHTML("beforeend",`
            <li id="${e.id}" class="quest" style="display:none">
                <input disabled type="checkbox" name="${e.name}" id="checkbox_${e.id}" >
                <label id="lab_${e.id}" for="checkbox_${e.id}">${e.name}</label>
            </li>
        `),e.bindDom(document.querySelector(`#${e.id}`),document.querySelector(`#checkbox_${e.id}`))}}clean(){const e=getCSSRuleIndex("#btn_pause_moon::before");e>=0&&e<document.styleSheets[0].cssRules.length&&document.styleSheets[0].deleteRule(e);const s=document.getElementsByClassName("quest");for(;s.length>0;)s[0].remove();const n=document.getElementById("projects");n&&(n.style.display="none");const i=document.getElementsByClassName("project");for(;i.length>0;)i[0].remove();const a=document.getElementsByClassName("job");for(;a.length>0;)a[0].remove();const o=document.getElementById("shop");o&&(o.style.display="none");const l=document.querySelectorAll('.shop input[type="number"]');for(const r of l)r.value="0";for(const r of document.getElementsByClassName("total"))r.textContent="0"}addLog(e){if(e.trim().length<=0)return;const s=document.getElementById("activity_log_container");if(s){for(;s.children.length>2;)s.children[0].remove();s.insertAdjacentHTML("beforeend",`<li>${e}</li>`)}}remove(e){const s=document.getElementById(e);s&&s.remove()}}class Inventory{constructor(e,s,n,i,a,o,l,r){h(this,"_max_villagers");h(this,"_villagers");h(this,"_max_houses");h(this,"_houses");h(this,"_max_sticks");h(this,"_sticks");h(this,"_max_stones");h(this,"_stones");h(this,"_max_woods");h(this,"_woods");h(this,"_max_berries");h(this,"_berries");h(this,"_max_offsprings");h(this,"_offsprings");h(this,"working_villagers");h(this,"sheds");h(this,"warehouses");this.eltWood=e,this.eltStone=s,this.eltStick=n,this.eltHouse=i,this.eltVillagers=a,this.eltBerry=o,this.eltOffspring=l,this.valueChanged=r,this._woods=0,this._max_woods=15,this._stones=0,this._max_stones=15,this._sticks=0,this._max_sticks=15,this._houses=0,this._max_houses=2,this._villagers=1,this._max_villagers=2,this.working_villagers=0,this._berries=0,this._max_berries=15,this._offsprings=0,this._max_offsprings=2,this.sheds=0,this.warehouses=0}get max_villagers(){return this._max_villagers}get villagers(){return this._villagers}get max_houses(){return this._max_houses}get houses(){return this._houses}get max_sticks(){return this._max_sticks}get sticks(){return this._sticks}get max_stones(){return this._max_stones}get stones(){return this._stones}get max_woods(){return this._max_woods}get woods(){return this._woods}get berries(){return this._berries}get max_berries(){return this._max_berries}get offsprings(){return this._offsprings}get max_offsprings(){return this._max_offsprings}set max_villagers(e){this._max_villagers=e,this.eltVillagers&&(this.eltVillagers.textContent=this.villagers+"/"+this.max_villagers)}set villagers(e){this._villagers=e,this._villagers>this._max_villagers&&(this._villagers=this._max_villagers),this.eltVillagers&&(this.eltVillagers.textContent=this.villagers+"/"+this.max_villagers)}set max_houses(e){this._max_houses=e,this.eltHouse&&(this.eltHouse.textContent=this.houses+"/"+this.max_houses)}set houses(e){this._houses=e,this._houses>this._max_houses&&(this._houses=this._max_houses),this.eltHouse&&(this.eltHouse.textContent=this.houses+"/"+this.max_houses)}set max_sticks(e){this._max_sticks=e,this.eltStick&&(this.eltStick.textContent=this.sticks+"/"+this.max_sticks)}set sticks(e){this._sticks=e,this._sticks>this._max_sticks&&(this._sticks=this._max_sticks),this.eltStick&&(this.eltStick.textContent=this.sticks+"/"+this.max_sticks),this.valueChanged&&this.valueChanged()}set max_stones(e){this._max_stones=e,this.eltStone&&(this.eltStone.textContent=this.stones+"/"+this.max_stones)}set stones(e){this._stones=e,this._stones>this._max_stones&&(this._stones=this._max_stones),this.eltStone&&(this.eltStone.textContent=this.stones+"/"+this.max_stones),this.valueChanged&&this.valueChanged()}set max_woods(e){this._max_woods=e,this.eltWood&&(this.eltWood.textContent=this.woods+"/"+this.max_woods)}set woods(e){this._woods=e,this._woods>this._max_woods&&(this._woods=this._max_woods),this.eltWood&&(this.eltWood.textContent=this.woods+"/"+this.max_woods),this.valueChanged&&this.valueChanged()}set berries(e){this._berries=e,this._berries>this._max_berries&&(this._berries=this._max_berries),this.eltBerry&&(this.eltBerry.textContent=this.berries+"/"+this.max_berries),this.valueChanged&&this.valueChanged()}set max_berries(e){this._max_berries=e,this.eltBerry&&(this.eltBerry.textContent=this.berries+"/"+this.max_berries)}set offsprings(e){this._offsprings=e,this._offsprings>this._max_offsprings&&(this._offsprings=this._max_offsprings),this.eltOffspring&&(this.eltOffspring.textContent=this.offsprings+"/"+this.max_offsprings),this.valueChanged&&this.valueChanged()}set max_offsprings(e){this._max_offsprings=e,this.eltOffspring&&(this.eltOffspring.textContent=this.offsprings+"/"+this.max_offsprings)}reset(){this.woods=0,this.max_woods=15,this.stones=0,this.max_stones=15,this.sticks=0,this.max_sticks=15,this.houses=0,this.max_houses=2,this.villagers=1,this.max_villagers=2,this.working_villagers=0,this.berries=0,this.max_berries=15}}const{vec2,rgb}=LittleJS;init();setShowSplashScreen(!0);const STARTING_TASK=["task_punch_berry","task_punch_tree","task_create_stick","task_punch_rock"],FOOD_PER_VILLAGER=2,FOOD_PER_OFFSPRING=1,FOOD_LIST=["berries"];document.getElementById("shop");document.getElementById("projects");const sfx_new_game=document.querySelector("#sfx_new_game"),btn_keep_playing=document.querySelector("#btn_keep_playing"),btn_prestige=document.querySelector("#btn_prestige"),btn_new_game=document.querySelector("#btn_new_game"),btn_start_game=document.querySelector("#btn_start_game"),btn_sell=document.querySelector("#btn_sell"),btn_pause_moon=document.querySelector("#btn_pause_moon"),btn_speed_moon=document.querySelector("#btn_speed_moon"),sfx_game_over=document.querySelector("#sfx_game_over"),moon_reached=document.getElementById("moon_reached"),shop_total=document.getElementById("shop_total"),progress_moon=document.querySelector("#progress_moon"),prestige=document.getElementById("prestige"),select_prestige=document.getElementById("select_prestige"),music_background=document.querySelector("#music_background"),suggest_prestige=document.getElementById("suggest_prestige"),sfx_task_cancelled=document.querySelector("#sfx_task_cancelled"),sfx_task_start=document.querySelector("#sfx_task_start"),sfx_moon_pause=document.querySelector("#sfx_moon_pause"),sfx_click=document.querySelector("#sfx_click"),sfx_quest_complete=document.querySelector("#sfx_quest_complete"),detail_title=document.getElementById("detail_title"),detail=document.getElementById("detail"),lab_moon_count=document.getElementById("lab_moon_count"),lab_food_count_red=document.getElementById("lab_food_count_red"),lab_food_count=document.getElementById("lab_food_count"),lab_money_count=document.getElementById("lab_money_count"),lab_moon_speed=document.getElementById("lab_moon_speed");let food,moon,money,isGameOver,timeMultiplier,costReduction=0,hasPrestige=!1,moonSpeed,isMoonPaused,foodNeeded,gameHasStarted=!1,inventory,data=new Data,domUtils=new DomUtils,listTasks,listShopEntry,listProjects,listUnlocks,listQuests,listPrestiges=[],listAutomations,enabledAutomations={},readyToUnlock={},resourcesSold,resourcesProduiced;function initVariables(){setPaused(!1),food=0,moon=1,money=0,isGameOver=!1,timeMultiplier=1,moonSpeed=.02,isMoonPaused=!1,foodNeeded=0,inventory=new Inventory(document.getElementById("lab_wood_count"),document.getElementById("lab_stone_count"),document.getElementById("lab_stick_count"),document.getElementById("lab_house_count"),document.getElementById("lab_villager_count"),document.getElementById("lab_berry_count"),document.getElementById("lab_offspring_count"),inventoryChanged),listTasks=[],listShopEntry=[],listProjects=[],listUnlocks=[],listQuests=[],listAutomations=[],hasPrestige||(listPrestiges=[]),resourcesSold={woods:0,sticks:0,berries:0,stones:0},resourcesProduiced={woods:0,sticks:0,berries:0,stones:0},enabledAutomations={auto_gather_food:!1,auto_build_shed:!1,auto_gather_wood:!1,auto_gather_stone:!1},enabledAutomations.auto_gather_stone,readyToUnlock={house:!1,procreation:!1,project:!1,shop:!1},readyToUnlock.house}function newGame(){initVariables(),sfx_new_game==null||sfx_new_game.play(),domUtils.clean();for(const t of listTasks)t.resetIcon();gameHasStarted=!0,setGameOverVisible(!1),setMainVisible(!0),setWelcomeVisible(!1),addTask(STARTING_TASK),listShopEntry=data.getAllShopEntryInstances(),listUnlocks=data.getAllUnlockInstances(),listQuests=data.getAllQuestInstances(),listAutomations=data.getAllAutomationInstances();for(const t of listQuests)domUtils.addQuest(t);for(const unlock of listUnlocks)unlock.condition=eval(`() => {
            ${unlock.strCondition}
        }`),unlock.action=eval(`() => {
            ${unlock.strAction}
        }`);for(const project of listProjects)project.action=eval(`() => {
            ${project.strAction}
        }`);for(const quest of listQuests)quest.condition=eval(`() => {
            ${quest.strCondition}
        }`);for(const task of listTasks)task.result.custom=eval(`() => {
            ${task.result.strCustom}
        }`);for(const auto of listAutomations)auto.stopCondition=eval(`() => {
            ${auto.strStopCondition}
        }`),auto.stopCondition=eval(`() => {
            ${auto.strStopCondition}
        }`);for(const t of listShopEntry)t.eltAmount&&t.eltAmount.addEventListener("input",inventoryChanged),t.valueChanged=updateMarketTotal;if(inventoryChanged(),disabledAllButton(!1),progress_moon&&(progress_moon.value=0),hasPrestige)for(const t of listPrestiges)data.getProjectInstanceByID(t).action()}function gameInit(){initVariables(),setGameOverVisible(!1),setMainVisible(!1),setWelcomeVisible(!0),setPrestigeVisible(!1),btn_keep_playing&&(btn_keep_playing.onclick=onBtnKeepPlayingPressed),btn_prestige&&(btn_prestige.onclick=onBtnPrestigePressed),btn_new_game&&(btn_new_game.onclick=newGame),btn_start_game&&(btn_start_game.onclick=newGame),btn_sell&&(btn_sell.onclick=onBtnSellPressed,btn_sell.addEventListener("keydown",t=>{console.log("down ",t.key),t.key=="Enter"&&onBtnSellPressed()})),btn_pause_moon&&(btn_pause_moon.onclick=onBtnPauseMoonPressed),btn_speed_moon&&(btn_speed_moon.onclick=onBtnSpeedPressed)}function gameUpdate(){if(!isGameOver){if(gameHasStarted&&music_background&&music_background.readyState===4&&music_background.paused&&(music_background==null||music_background.play()),showGameStatus(),!isMoonPaused)for(const t of listTasks)t.isRunning&&t.progress&&(t.progress.value+=t.speed*timeMultiplier,t.onCompleted&&t.progress.value>=t.progress.max&&t.onCompleted());checkTaskAvailability(),checkProjectAvailability(),checkUnlocks(),checkQuests(),checkAutomations(),inventory.villagers<=0&&!isGameOver&&(isGameOver=!0,sfx_game_over==null||sfx_game_over.play(),setGameOverVisible(isGameOver),setMainVisible(!0),setWelcomeVisible(!1),moon_reached&&(moon_reached.textContent=(moon-1).toString()),disabledAllButton())}}function gameUpdatePost(){}function gameRender(){drawRect(vec2(),vec2(1920,1080),rgb(1,1,1,1))}function gameRenderPost(){}function onTaskCompleted(){const t=this;if(t.result.modifyInventoryCap){for(let i in t.result)if(i in inventory){const a="max_"+i,o=i;inventory[a]+=t.result[o]}}else for(let i in t.result)if(i in inventory){const a=i,o=i;inventory[a]+=t.result[o],i in resourcesProduiced&&(resourcesProduiced[i]+=t.result[i])}t.result.custom(),inventory.working_villagers-=t.need.villagers,t.stop();let e=!1,s=null;for(const i of listAutomations)if(i.isWaiting){s=i,e=!0;break}const n=inventory.villagers>inventory.working_villagers+t.need.villagers;t.autoRestart&&!t.isCancelled?!n&&e?s&&(s.stoppedTaskID=t.id):startTask(t):t.resetIcon(),t.autoRemove&&(domUtils.remove(t.id),listTasks=listTasks.filter(i=>i.id!=t.id))}function cancelTask(t){t.stop(!0),restoreCost(t.need)}function onTaskBtnPressed(){if(!(isMoonPaused||isGameOver)){var t=this;t.isRunning?(sfx_task_cancelled==null||sfx_task_cancelled.play(),cancelTask(t)):(sfx_task_start==null||sfx_task_start.play(),startTask(t))}}function onBtnSpeedPressed(){isGameOver||(sfx_moon_pause==null||sfx_moon_pause.play(),timeMultiplier*=2,timeMultiplier==2?music_background&&(music_background.playbackRate=1.2):timeMultiplier==4?music_background&&(music_background.playbackRate=1.4):timeMultiplier==8?music_background&&(music_background.playbackRate=1.6):timeMultiplier>8&&(timeMultiplier=1,music_background&&(music_background.playbackRate=1)),lab_moon_speed&&(lab_moon_speed.textContent=String(timeMultiplier)))}function onBtnPauseMoonPressed(){if(isGameOver)return;sfx_moon_pause==null||sfx_moon_pause.play();const t=getCSSRuleIndex("#btn_pause_moon::before");t>=0&&t<document.styleSheets[0].cssRules.length&&document.styleSheets[0].deleteRule(t),isMoonPaused=!isMoonPaused,isMoonPaused&&document.styleSheets[0].insertRule('#btn_pause_moon::before{content:"►";}')}function onProjectPressed(t){!t.element||t.element.ariaDisabled==="true"||t.isRemoved||isGameOver||isMoonPaused||(sfx_click==null||sfx_click.play(),money-=t.cost,t.action(),t.isRemoved=!0,domUtils.addLog(t.log),domUtils.remove(t.element.id),listProjects=listProjects.filter(e=>!e.isRemoved))}function onBtnSellPressed(){if(!isGameOver){sfx_click==null||sfx_click.play(),shop_total&&shop_total.textContent!==null&&(money+=parseInt(shop_total.textContent));for(const t of listShopEntry)t.id in inventory&&(inventory[t.id]-=t._amount,resourcesSold[t.id]+=parseInt(t._amount),t.eltAmount.value=0,t.amount=0)}}function onBtnKeepPlayingPressed(){setPrestigeVisible(!1),hasPrestige=!1}function onBtnPrestigePressed(){if(!select_prestige||!suggest_prestige)return;hasPrestige=!0,prestige&&(prestige.style.width="500");let t=document.querySelectorAll(".prestige_choice");for(const e of t)e.onclick=()=>{prestige&&(prestige.style.width="400"),setPrestigeVisible(!1),select_prestige.style.display="none",suggest_prestige.style.display="block",listPrestiges.push(e.id),newGame()};select_prestige.style.display="block",suggest_prestige.style.display="none"}function isInventoryFull(t=!1){if(t)return!1;const e=["woods","sticks","stones","berries"];for(const s of e)if(s in inventory&&`max_${s}`in inventory&&inventory[s]>=inventory[`max_${s}`])return!0;return!1}isInventoryFull(!0);function hasEnoughResourcesForTask(t){let e=inventory.villagers-inventory.working_villagers;for(let s in t.need)if(s!="villagers"&&t.need[s]>0&&t.need[s]>inventory[s])return!1;return e>=t.need.villagers}function whatIsLackingForTask(t){let e=inventory.villagers-inventory.working_villagers,s={};for(let n in t.need)n!="villagers"&&t.need[n]>0&&t.need[n]>inventory[n]&&(s[n]=t.need[n]-inventory[n]);return e<t.need.villagers&&(s.villagers=t.need.villagers),s}function hasEnoughInventorySpace(t){if(t.result.modifyInventoryCap)return!0;for(const e in t.result)if(e in inventory&&inventory[`max_${e}`]<t.result[e]+inventory[e])return!1;return!0}function checkTaskAvailability(){for(let t of listTasks){if(t.whyDisabled="",!hasEnoughInventorySpace(t))t.whyDisabled="Inventory is full";else if(!hasEnoughResourcesForTask(t)){t.whyDisabled="Lacking: ";const e=whatIsLackingForTask(t);for(const s in e)s==="villagers"&&(t.whyDisabled+="free "),t.whyDisabled+=`${s}(${e[s]}), `}t.btn&&(isGameOver||isMoonPaused||!hasEnoughInventorySpace(t)?t.btn.disabled=!0:t.btn.disabled=!t.isRunning&&!hasEnoughResourcesForTask(t),t.btn.disabled&&!isMoonPaused&&t.resetIcon())}}function checkProjectAvailability(){for(const t of listProjects)t.element&&(t.cost>money?t.element.ariaDisabled="true":t.element.ariaDisabled="false")}function checkUnlocks(){for(const t of listUnlocks)t.condition()&&!t.isCompleted&&(t.action(),t.isCompleted=!0,domUtils.addLog(t.name))}function checkQuests(){for(const s of listQuests)!s.isCompleted&&s.eltQuest&&s.eltQuest.style.display=="block"&&s.condition()&&(s.isCompleted=!0,sfx_quest_complete==null||sfx_quest_complete.play(),domUtils.addLog(`Quest Completed : ${s.name} `));let t=0,e=0;for(const s of listQuests)if(!s.isCompleted&&s.eltQuest){if(s.eltQuest.style.display="block",s.isCompleted=!1,e++,t<4)break;if(e>=2)break}else t++}function checkAutomations(){for(let t of listAutomations){let e=t;e.isRunning?(e.stopCondition()||e.runningTask!=null&&!e.runningTask.isRunning)&&(e.isRunning=!1,e.runningTask&&(e.runningTask.autoRestart=e.storedAutoRestart),e.runningTask=null,e.stoppedTaskID!=""&&startTaskID(e.stoppedTaskID)):e.startCondition()&&(inventory.villagers>inventory.working_villagers?(e.runningTask&&(e.runningTask=startTaskID(e.taskID)),e.runningTask!=null&&(e.storedAutoRestart=e.runningTask.autoRestart,e.runningTask.autoRestart=!1,e.isRunning=!0,e.isWaiting=!1)):e.isWaiting=!0)}}function suggestPrestige(t=!1){t||(isMoonPaused=!0,setPrestigeVisible(!0))}suggestPrestige(!0);function addTask(IDs){for(const id of IDs){const task=data.getTaskInstanceByID(id);task!=null&&(task.result.custom=eval(`() => {
                ${task.result.strCustom}
            }`),listTasks.push(task),domUtils.addTask(task),task.btn&&(task.btn.onclick=onTaskBtnPressed.bind(task)),task.onCompleted=onTaskCompleted.bind(task),task.labTitle&&detail&&detail_title&&(task.labTitle.onmouseenter=function(){detail_title.textContent=task.name,task.whyDisabled.trim().length>0?detail.innerHTML=task.details+`<br/><b style="color:red">${task.whyDisabled}</b><br/>Requires:<br/>`+task.describedNeed:detail.innerHTML=task.details+"<br/><br/>Requires:<br/>"+task.describedNeed}),task.labTitle&&detail_title&&detail&&(task.labTitle.onmouseleave=function(){detail_title.textContent="",detail.innerHTML=""}))}}function addProject(IDs=[]){for(const id of IDs){const project=data.getProjectInstanceByID(id);project!=null&&(project.action=eval(`() => {
                ${project.strAction}
            }`),project.cost-=project.cost*costReduction,listProjects.push(project),domUtils.addProject(project),project.element&&(project.element.onclick=()=>{onProjectPressed(project)}))}}addProject();function applyCost(t){inventory.working_villagers+=t.villagers;for(let e in t)e!="villagers"&&(inventory[e]-=t[e])}function startTask(t){return hasEnoughResourcesForTask(t)&&hasEnoughInventorySpace(t)?(applyCost(t.need),t.start(),!0):(t.resetIcon(),!1)}function startTaskID(t){for(const e of listTasks)if(e.id===t)return startTask(e)&&e.setRunningIcon(),e;return null}function restoreCost(t){for(let e in t)e!="villagers"&&(inventory[e]+=t[e]);inventory.working_villagers-=t.villagers}function showGameStatus(){if(!(!lab_moon_count||!lab_food_count_red||!lab_food_count||!progress_moon||!lab_money_count)){food=0,foodNeeded=inventory.villagers*FOOD_PER_VILLAGER+inventory.offsprings*FOOD_PER_OFFSPRING,lab_moon_count.textContent=moon.toString();for(let t of FOOD_LIST)t in inventory&&(food+=inventory[t]);food<foodNeeded?(lab_food_count_red.style.display="block",lab_food_count_red.textContent=`Food: ${food}/${foodNeeded}`,lab_food_count.style.display="none"):(lab_food_count_red.style.display="none",lab_food_count.style.display="block",lab_food_count.textContent=`Food: ${food}/${foodNeeded}`),isMoonPaused||(progress_moon.value+=moonSpeed*timeMultiplier,progress_moon.value>=100&&(progress_moon.value=0,feedVillagers(),moon+=1)),lab_money_count.textContent=money.toString()}}function feedVillagers(){let t=food/FOOD_PER_VILLAGER-food%FOOD_PER_VILLAGER,e=Math.floor(inventory.villagers-t);for(e<0&&(e=0);foodNeeded>0&&food>0;)for(let s of FOOD_LIST)s in inventory&&(inventory[s]-=1,food-=1,foodNeeded-=1);inventory.villagers-=e}function updateMarketTotal(){let t=0;for(const e of listShopEntry)t+=e.total;shop_total&&(shop_total.textContent=t.toString()),btn_sell&&(btn_sell.disabled=t<=0)}function inventoryChanged(){for(const t of listShopEntry){const e=t;e.id in inventory&&(e.eltAmount.max=inventory[e.id],e.eltAmount.value>inventory[e.id]&&(e.eltAmount.value=inventory[e.id],e.amount=inventory[e.id]))}}function disabledAllButton(t=!0){for(const e of document.getElementsByTagName("button"))e.id!="btn_new_game"&&(e.disabled=t)}function totalResourcesSold(){let t=0;for(const e in resourcesSold)t+=resourcesSold[e];return t}totalResourcesSold();function totalResourcesProduiced(){let t=0;for(const e in resourcesProduiced)t+=resourcesProduiced[e];return t}totalResourcesProduiced();setHeadlessMode(!0);engineInit(gameInit,gameUpdate,gameUpdatePost,gameRender,gameRenderPost);
